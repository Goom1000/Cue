---
phase: 02-permission-ux
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/PresentationView.tsx
autonomous: true

must_haves:
  truths:
    - "Button shows 'Launch -> External Display' when permission granted"
    - "Button shows 'Launch Student View' when permission is prompt or denied"
    - "Button displays warning icon when permission denied"
    - "Toast appears for 5 seconds after successful launch confirming placement"
  artifacts:
    - path: "components/PresentationView.tsx"
      provides: "Updated button label logic and launch toast"
      contains: "Launch.*External Display"
  key_links:
    - from: "components/PresentationView.tsx"
      to: "useWindowManagement hook"
      via: "permissionState determines button label"
      pattern: "permissionState.*granted.*External Display"
---

<objective>
Update launch button to show permission-aware labels and add launch feedback toast.

Purpose: Teacher always knows current auto-placement capability at a glance. After launch, toast confirms where window opened.

Output: Modified PresentationView.tsx with dynamic button labels, warning icon for denied state, and 5-second placement toast.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-permission-ux/02-CONTEXT.md
@.planning/phases/02-permission-ux/02-RESEARCH.md
@.planning/phases/v1.2-01-permission-state-loading/01-01-SUMMARY.md

@components/PresentationView.tsx
@components/Toast.tsx
@hooks/useWindowManagement.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update button label logic</name>
  <files>components/PresentationView.tsx</files>
  <action>
Modify the launch button label logic (around lines 467-482) to implement CONTEXT.md decisions:

1. Create a helper function `getLaunchButtonLabel()` that returns the appropriate label:
   - If `isLoading`: return `'Checking displays...'`
   - If `isConnected`: return `'Student Active'`
   - If `permissionState === 'granted'`: return `'Launch \u2192 External Display'` (use Unicode arrow, not raw display name per CONTEXT.md)
   - Otherwise (prompt, denied, unavailable): return `'Launch Student View'`

2. Replace the current inline ternary logic in the button text with a call to this helper function.

3. The button styling already handles `isLoading` (cursor-wait) and `isConnected` (green glow) - verify these still apply correctly.

Note: Use "External Display" as friendly label per CONTEXT.md, NOT raw `secondaryScreen.label` like "DELL U2718Q".
  </action>
  <verify>
Read the modified button code. Verify:
- Button shows "Launch -> External Display" when permissionState is 'granted'
- Button shows "Launch Student View" when permissionState is 'prompt', 'denied', or 'unavailable'
- Button shows "Checking displays..." when isLoading is true
- Button shows "Student Active" when isConnected is true
  </verify>
  <done>Button label dynamically reflects permission state per CONTEXT.md decisions</done>
</task>

<task type="auto">
  <name>Task 2: Add warning icon for denied state</name>
  <files>components/PresentationView.tsx</files>
  <action>
Add a warning icon to the launch button when permissionState is 'denied':

1. Add the warning icon SVG inside the button, conditionally rendered:
   ```tsx
   {permissionState === 'denied' && !isLoading && !isConnected && (
     <svg
       className="w-4 h-4 text-amber-400 mr-1"
       fill="currentColor"
       viewBox="0 0 20 20"
     >
       <path
         fillRule="evenodd"
         d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
         clipRule="evenodd"
       />
     </svg>
   )}
   ```

2. Position the icon before the button text. Add `flex items-center` to button if not already present.

3. Keep the icon subtle (amber-400) - it's a hint, not an alarm.
  </action>
  <verify>
Read the button code. Verify warning icon renders when permissionState === 'denied'.
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Warning icon appears on button when permission is denied</done>
</task>

<task type="auto">
  <name>Task 3: Add launch feedback toast</name>
  <files>components/PresentationView.tsx</files>
  <action>
Add toast feedback after successful window launch:

1. Find the launch button onClick handler (around line 441-464).

2. After the `if (!studentWindow || studentWindow.closed...)` check (the popup blocked check), add toast for successful launch:
   ```tsx
   // Show placement feedback toast (5 seconds per PERM-04)
   if (secondaryScreen) {
     addToast('Opened on External Display', 5000);
   } else {
     addToast('Opened on this screen', 5000);
   }
   ```

3. Place this AFTER the popup blocked check but still inside the else branch (when popup was NOT blocked).

4. The `addToast` function is already available from the `useToast` hook destructuring at line 222.

Note: Use "External Display" (friendly label) not raw display name per CONTEXT.md.
  </action>
  <verify>
Read the launch handler code. Verify:
- Toast shows "Opened on External Display" when secondaryScreen exists
- Toast shows "Opened on this screen" when no secondaryScreen
- Toast duration is 5000ms
- Toast only fires when popup is NOT blocked

Manual test: Launch student window and verify toast appears for 5 seconds.
  </verify>
  <done>5-second toast confirms window placement after successful launch</done>
</task>

</tasks>

<verification>
- [ ] TypeScript compiles: `npx tsc --noEmit`
- [ ] Button shows "Launch -> External Display" when granted (inspect code)
- [ ] Button shows "Launch Student View" when prompt/denied/unavailable (inspect code)
- [ ] Warning icon appears on button when denied (inspect code)
- [ ] Toast fires with correct message after successful launch (inspect code)
- [ ] No regression: "Checking displays..." still shows during loading
- [ ] No regression: "Student Active" still shows when connected
</verification>

<success_criteria>
1. PERM-02 satisfied: Button reflects auto-placement status
2. PERM-05 satisfied: "External Display" shown on button when granted
3. PERM-04 partially satisfied: Toast confirms placement (full satisfaction requires manual test)
4. Warning icon provides visual cue for denied state (pairs with recovery UI in Plan 03)
</success_criteria>

<output>
After completion, create `.planning/phases/02-permission-ux/02-01-SUMMARY.md`
</output>
