---
phase: 23-the-chase
plan: 08
type: execute
wave: 4
depends_on: ["23-02", "23-04", "23-07"]
files_modified:
  - components/StudentGameView.tsx
autonomous: true

must_haves:
  truths:
    - "Student view displays Chase game state for all phases"
    - "Cash Builder shows timer, score, and current question"
    - "Offer Selection shows voting widget when votes open"
    - "Head-to-Head shows game board with positions"
    - "Final Chase shows scores and countdown timers"
  artifacts:
    - path: "components/StudentGameView.tsx"
      provides: "Chase game student view for all phases"
      contains: "TheChaseStudentView"
  key_links:
    - from: "components/StudentGameView.tsx"
      to: "components/games/the-chase/GameBoard.tsx"
      via: "board display"
      pattern: "GameBoard"
    - from: "components/StudentGameView.tsx"
      to: "components/games/the-chase/VotingWidget.tsx"
      via: "voting participation"
      pattern: "VotingWidget"
---

<objective>
Add student view rendering for The Chase game in all phases.

Purpose: Students need to see game progress on the projected view. Each phase has different display requirements: timer and score for Cash Builder, voting UI for Offer Selection, game board for Head-to-Head, and dual timers/scores for Final Chase.

Output: TheChaseStudentView component in StudentGameView.tsx with phase-specific rendering.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/23-the-chase/23-CONTEXT.md
@.planning/phases/23-the-chase/23-02-SUMMARY.md
@.planning/phases/23-the-chase/23-04-SUMMARY.md
@.planning/phases/23-the-chase/23-07-SUMMARY.md
@components/StudentGameView.tsx
@components/games/the-chase/GameBoard.tsx
@components/games/the-chase/VotingWidget.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TheChaseStudentView component</name>
  <files>components/StudentGameView.tsx</files>
  <action>
Add a new component for Chase game student view:

1. Import new components and types at the top:
```typescript
import { TheChaseState } from '../types';
import GameBoard from './games/the-chase/GameBoard';
import VotingWidget from './games/the-chase/VotingWidget';
```

2. Add TheChaseStudentView component after MillionaireStudentView:
```typescript
// The Chase student view - displays game state for all phases
const TheChaseStudentView: React.FC<{ state: TheChaseState }> = ({ state }) => {
  const formatTime = (seconds: number): string => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  // Calculate prize based on selected offer
  const getPrize = (): number => {
    if (state.selectedOfferIndex === null) return state.cashBuilderScore;
    const multipliers = [2, 1, 0.5];
    return Math.floor(state.cashBuilderScore * multipliers[state.selectedOfferIndex]);
  };

  // Cash Builder phase
  if (state.phase === 'cash-builder') {
    const currentQuestion = state.questions[state.currentQuestionIndex];

    return (
      <div className="h-screen w-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex flex-col p-8 font-poppins">
        {/* Header */}
        <div className="flex justify-between items-center mb-8">
          <div className="bg-slate-800/80 rounded-xl px-8 py-4 border-2 border-slate-600">
            <div className="text-xs text-slate-400 uppercase">Time</div>
            <div className={`text-6xl font-mono font-bold ${
              state.cashBuilderTimeRemaining <= 10 ? 'text-red-500 animate-pulse' : 'text-white'
            }`}>
              {formatTime(state.cashBuilderTimeRemaining)}
            </div>
          </div>

          <h2 className="text-4xl font-black text-amber-400 uppercase tracking-widest">
            Cash Builder
          </h2>

          <div className="bg-slate-800/80 rounded-xl px-8 py-4 border-2 border-amber-500/30">
            <div className="text-xs text-slate-400 uppercase">Prize</div>
            <div className="text-6xl font-bold text-amber-400">
              ${state.cashBuilderScore.toLocaleString()}
            </div>
          </div>
        </div>

        {/* Question */}
        <div className="flex-1 flex flex-col justify-center max-w-5xl mx-auto w-full">
          <div className="bg-slate-800/60 p-10 rounded-2xl border-2 border-slate-600 mb-8">
            <p className="text-3xl md:text-4xl font-bold text-white text-center">
              {currentQuestion?.question}
            </p>
          </div>

          {/* Options grid */}
          {currentQuestion && (
            <div className="grid grid-cols-2 gap-6">
              {currentQuestion.options.map((option, idx) => (
                <div
                  key={idx}
                  className="p-6 rounded-xl bg-slate-700/60 border-2 border-slate-600"
                >
                  <span className="text-slate-400 mr-4 text-xl">{idx + 1}.</span>
                  <span className="text-xl font-bold text-white">{option}</span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    );
  }

  // Offer Selection phase - show voting widget
  if (state.phase === 'offer-selection') {
    if (state.isVotingOpen) {
      return <VotingWidget />;
    }

    // Show offers while teacher sets them up
    return (
      <div className="h-screen w-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex flex-col items-center justify-center p-8 font-poppins">
        <h2 className="text-5xl font-black text-amber-400 uppercase tracking-widest mb-8">
          Choose Your Offer
        </h2>
        <p className="text-2xl text-slate-300 mb-4">
          Cash Builder: <span className="text-amber-400 font-bold">${state.cashBuilderScore.toLocaleString()}</span>
        </p>
        <p className="text-xl text-slate-400">Waiting for teacher to start voting...</p>
      </div>
    );
  }

  // Head-to-Head phase - show game board and question
  if (state.phase === 'head-to-head') {
    const currentQuestion = state.questions[state.currentQuestionIndex];

    return (
      <div className="h-screen w-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex p-8 font-poppins">
        {/* Left: Game Board */}
        <div className="w-1/3 flex flex-col items-center justify-center">
          <h3 className="text-2xl font-bold text-amber-400 mb-6 uppercase tracking-wider">
            The Chase
          </h3>
          <GameBoard
            contestantPosition={state.contestantPosition}
            chaserPosition={state.chaserPosition}
          />
          <div className="mt-6 text-center">
            <p className="text-slate-400">
              Prize: <span className="text-amber-400 font-bold">${getPrize().toLocaleString()}</span>
            </p>
          </div>
        </div>

        {/* Right: Question */}
        <div className="flex-1 flex flex-col justify-center px-8">
          <div className="bg-slate-800/60 p-10 rounded-2xl border-2 border-slate-600 mb-8">
            <p className="text-3xl md:text-4xl font-bold text-white">
              {currentQuestion?.question}
            </p>
          </div>

          {currentQuestion && (
            <div className="grid grid-cols-2 gap-6">
              {currentQuestion.options.map((option, idx) => {
                const showResult = state.contestantAnswer !== null || state.showChaserAnswer;
                const isCorrect = idx === currentQuestion.correctAnswerIndex;

                return (
                  <div
                    key={idx}
                    className={`p-6 rounded-xl border-2 ${
                      showResult
                        ? isCorrect
                          ? 'bg-green-600 border-green-400'
                          : 'bg-slate-700/60 border-slate-600'
                        : 'bg-slate-700/60 border-slate-600'
                    }`}
                  >
                    <span className="text-slate-400 mr-4 text-xl">{String.fromCharCode(65 + idx)}.</span>
                    <span className="text-xl font-bold text-white">{option}</span>
                  </div>
                );
              })}
            </div>
          )}
        </div>
      </div>
    );
  }

  // Final Chase phases
  if (state.phase === 'final-chase-contestant' || state.phase === 'final-chase-chaser') {
    const isContestantPhase = state.phase === 'final-chase-contestant';
    const currentQuestion = state.questions[state.currentQuestionIndex];

    return (
      <div className={`h-screen w-screen flex flex-col p-8 font-poppins ${
        isContestantPhase
          ? 'bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900'
          : 'bg-gradient-to-br from-red-900 via-red-800 to-rose-900'
      }`}>
        {/* Header with scores and timer */}
        <div className="flex justify-between items-center mb-8">
          <div className="bg-blue-800/60 rounded-xl px-8 py-4 border-2 border-blue-600">
            <div className="text-xs text-blue-300 uppercase">Contestant</div>
            <div className="text-5xl font-bold text-white">{state.finalChaseContestantScore}</div>
          </div>

          <div className="text-center">
            <h2 className="text-3xl font-black text-white uppercase tracking-widest mb-2">
              {isContestantPhase ? "CONTESTANT'S ROUND" : "CHASER'S ROUND"}
            </h2>
            <div className={`text-7xl font-mono font-bold ${
              (isContestantPhase ? state.finalChaseContestantTime : state.finalChaseChaserTime) <= 10
                ? 'text-red-400 animate-pulse'
                : 'text-white'
            }`}>
              {formatTime(isContestantPhase ? state.finalChaseContestantTime : state.finalChaseChaserTime)}
            </div>
          </div>

          <div className="bg-red-800/60 rounded-xl px-8 py-4 border-2 border-red-600">
            <div className="text-xs text-red-300 uppercase">Chaser</div>
            <div className="text-5xl font-bold text-white">{state.finalChaseChaserScore}</div>
            <div className="text-xs text-red-300 mt-1">Target: {state.chaserTargetScore}</div>
          </div>
        </div>

        {/* Question */}
        <div className="flex-1 flex flex-col justify-center max-w-5xl mx-auto w-full">
          <div className="bg-white/10 p-10 rounded-2xl border-2 border-white/20 mb-8">
            <p className="text-3xl md:text-4xl font-bold text-white text-center">
              {currentQuestion?.question}
            </p>
          </div>

          {currentQuestion && (
            <div className="grid grid-cols-2 gap-6">
              {currentQuestion.options.map((option, idx) => (
                <div
                  key={idx}
                  className="p-6 rounded-xl bg-white/10 border-2 border-white/20"
                >
                  <span className="opacity-60 mr-4 text-xl">{String.fromCharCode(65 + idx)}.</span>
                  <span className="text-xl font-bold text-white">{option}</span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    );
  }

  // Game over - show result
  if (state.phase === 'game-over') {
    const win = state.finalChaseChaserScore < state.chaserTargetScore;

    return (
      <div className={`h-screen w-screen flex items-center justify-center font-poppins ${
        win
          ? 'bg-gradient-to-br from-green-900 via-green-800 to-emerald-900'
          : 'bg-gradient-to-br from-red-900 via-red-800 to-rose-900'
      }`}>
        <div className="text-center">
          <div className="text-9xl mb-6">{win ? 'üèÜ' : 'üòà'}</div>
          <h2 className={`text-6xl font-black mb-4 ${win ? 'text-green-400' : 'text-red-400'}`}>
            {win ? 'YOU WIN!' : 'CAUGHT!'}
          </h2>
          <p className="text-3xl text-white">
            {win
              ? `Prize: $${getPrize().toLocaleString()}`
              : 'The Chaser wins!'}
          </p>
        </div>
      </div>
    );
  }

  // Default fallback
  return (
    <div className="h-screen w-screen bg-slate-900 flex items-center justify-center font-poppins">
      <GameSplash gameType="the-chase" />
    </div>
  );
};
```

3. Update the main StudentGameView component routing to include TheChaseStudentView:

Find the section after Millionaire check and before PlaceholderStudentView:
```typescript
if (gameState.gameType === 'the-chase') {
  return <TheChaseStudentView state={gameState} />;
}
```
  </action>
  <verify>Run `npm run build` - should compile without errors</verify>
  <done>StudentGameView displays The Chase game state for all phases via BroadcastChannel sync</done>
</task>

</tasks>

<verification>
- `npm run build` passes with no TypeScript errors
- Student view updates for each Chase phase
- Cash Builder shows timer and score
- Offer Selection shows voting widget when open
- Head-to-Head shows game board with positions
- Final Chase shows dual timers and scores
- Game over shows win/loss result
</verification>

<success_criteria>
- TheChaseStudentView renders all 5 phases correctly
- Cash Builder phase shows countdown timer and running score
- Offer Selection phase integrates VotingWidget when voting open
- Head-to-Head phase shows GameBoard with positions
- Final Chase shows contestant/chaser scores and timers
- Game over shows appropriate win/loss screen
- All displays sync via BroadcastChannel from teacher view
</success_criteria>

<output>
After completion, create `.planning/phases/23-the-chase/23-08-SUMMARY.md`
</output>
