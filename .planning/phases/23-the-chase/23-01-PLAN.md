---
phase: 23-the-chase
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - types.ts
  - hooks/useTimer.ts
  - components/games/shared/Timer.tsx
autonomous: true

must_haves:
  truths:
    - "TheChaseState type includes all game phase fields (phase, positions, scores, timer state)"
    - "useTimer hook provides countdown with start/pause/reset/formattedTime"
    - "Timer component displays countdown visually with color changes at 10s"
  artifacts:
    - path: "types.ts"
      provides: "Extended TheChaseState type"
      contains: "ChasePhase"
    - path: "hooks/useTimer.ts"
      provides: "Countdown timer hook"
      exports: ["useTimer"]
    - path: "components/games/shared/Timer.tsx"
      provides: "Visual countdown display"
      min_lines: 30
  key_links:
    - from: "hooks/useTimer.ts"
      to: "setInterval"
      via: "interval management"
      pattern: "setInterval"
    - from: "components/games/shared/Timer.tsx"
      to: "hooks/useTimer.ts"
      via: "hook usage"
      pattern: "useTimer"
---

<objective>
Establish The Chase type system and reusable timer infrastructure for all timed rounds.

Purpose: TheChaseState needs extension from placeholder to full game state with multi-phase support. The timer hook and component will be used across Cash Builder (60s), Final Chase contestant round (2min), and Final Chase chaser round (2min).

Output: Extended types.ts with ChasePhase union and full TheChaseState, useTimer hook with pause/resume, Timer display component with urgency styling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/23-the-chase/23-CONTEXT.md
@.planning/phases/23-the-chase/23-RESEARCH.md
@types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend TheChaseState type with full game state structure</name>
  <files>types.ts</files>
  <action>
Extend the existing TheChaseState interface to support multi-phase gameplay:

1. Add ChasePhase type union:
```typescript
export type ChasePhase =
  | 'cash-builder'
  | 'offer-selection'
  | 'head-to-head'
  | 'final-chase-contestant'
  | 'final-chase-chaser'
  | 'game-over';
```

2. Add ChaseOffer interface for offer selection:
```typescript
export interface ChaseOffer {
  amount: number;      // Prize money
  position: number;    // Starting position (1-5, where 3 is middle)
  label: string;       // "High Offer (+2 steps)" etc
}
```

3. Update TheChaseState to include all fields:
```typescript
export interface TheChaseState extends BaseGameState {
  gameType: 'the-chase';
  phase: ChasePhase;
  // Cash Builder state
  cashBuilderScore: number;
  cashBuilderTimeRemaining: number;
  // Offer state
  offers: ChaseOffer[];
  selectedOfferIndex: number | null;
  votes: Record<string, number>;  // studentName -> offerIndex
  isVotingOpen: boolean;
  // Head-to-Head state
  contestantPosition: number;  // 0-6 (0=top, 6=home)
  chaserPosition: number;      // 0-6
  chaserDifficulty: 'easy' | 'medium' | 'hard';
  isAIControlled: boolean;
  isChaserThinking: boolean;
  // Final Chase state
  finalChaseContestantScore: number;  // Questions answered
  finalChaseContestantTime: number;   // Seconds remaining
  finalChaseChaserScore: number;
  finalChaseChaserTime: number;
  chaserTargetScore: number;  // Score needed to catch (contestant's final score)
  // Question state
  currentQuestionAnswered: boolean;
  contestantAnswer: number | null;
  chaserAnswer: number | null;
  showChaserAnswer: boolean;
}
```

Keep the existing placeholder fields (chaserPosition, contestantPosition, isChasing) for backward compatibility - they overlap with the new fields which is fine.
  </action>
  <verify>Run `npm run build` - should compile without errors</verify>
  <done>TheChaseState type includes ChasePhase union and all fields for multi-phase gameplay</done>
</task>

<task type="auto">
  <name>Task 2: Create useTimer hook with pause/resume capability</name>
  <files>hooks/useTimer.ts</files>
  <action>
Create a reusable countdown timer hook following the pattern from RESEARCH.md:

```typescript
import { useState, useEffect, useRef, useCallback } from 'react';

interface TimerConfig {
  initialSeconds: number;
  onComplete?: () => void;
  onTick?: (remaining: number) => void;
  autoStart?: boolean;
}

interface TimerResult {
  timeRemaining: number;
  isRunning: boolean;
  start: () => void;
  pause: () => void;
  reset: (seconds?: number) => void;
  formattedTime: string;
}

export function useTimer({
  initialSeconds,
  onComplete,
  onTick,
  autoStart = false
}: TimerConfig): TimerResult {
  // Implementation per RESEARCH.md Pattern 2
  // - useState for timeRemaining and isRunning
  // - useRef for interval ID
  // - useEffect with setInterval when running
  // - Cleanup function to clear interval on unmount
  // - start(), pause(), reset(seconds?) functions
  // - formatTime helper (MM:SS format)
}

function formatTime(seconds: number): string {
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}
```

Key behaviors:
- Timer decrements every 1000ms when running
- Calls onTick with remaining time each second
- Calls onComplete when reaching 0
- reset() can optionally take new seconds value
- formattedTime returns "M:SS" format
  </action>
  <verify>Run `npm run build` - should compile without errors</verify>
  <done>useTimer hook exports start, pause, reset, timeRemaining, isRunning, formattedTime</done>
</task>

<task type="auto">
  <name>Task 3: Create Timer display component with urgency styling</name>
  <files>components/games/shared/Timer.tsx</files>
  <action>
Create a visual timer component that uses useTimer internally:

```typescript
import React from 'react';
import { useTimer } from '../../../hooks/useTimer';

interface TimerProps {
  initialSeconds: number;
  onComplete?: () => void;
  onTick?: (remaining: number) => void;
  autoStart?: boolean;
  size?: 'small' | 'large';
  urgencyThreshold?: number;  // Seconds at which color changes (default 10)
  className?: string;
  // External control (optional)
  externalControl?: {
    start: () => void;
    pause: () => void;
    reset: () => void;
    timeRemaining: number;
    isRunning: boolean;
  };
}
```

Component features:
1. Display time in large, bold format
2. Normal state: white/blue text
3. Urgency state (<=10s): red text, pulsing animation
4. Size variants: small (for inline), large (for prominent display)
5. If externalControl provided, use those values instead of internal hook

Styling:
```jsx
<div className={`
  font-mono font-bold text-center
  ${size === 'large' ? 'text-6xl' : 'text-2xl'}
  ${timeRemaining <= urgencyThreshold
    ? 'text-red-500 animate-pulse'
    : 'text-white'}
  ${className}
`}>
  {formattedTime}
</div>
```

Export both the component and re-export useTimer for convenience.
  </action>
  <verify>Run `npm run build` - should compile without errors</verify>
  <done>Timer component displays countdown with size variants and urgency state at 10 seconds</done>
</task>

</tasks>

<verification>
- `npm run build` passes with no TypeScript errors
- types.ts exports ChasePhase, ChaseOffer, and extended TheChaseState
- hooks/useTimer.ts exports useTimer function
- components/games/shared/Timer.tsx exports Timer component
</verification>

<success_criteria>
- TheChaseState includes phase field with ChasePhase union type
- TheChaseState includes all fields for Cash Builder, Offer Selection, Head-to-Head, and Final Chase
- useTimer hook provides countdown with start/pause/reset/formattedTime
- Timer component changes color at urgency threshold (default 10s)
- All code compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/23-the-chase/23-01-SUMMARY.md`
</output>
