---
phase: 41-tour-infrastructure-accessibility
plan: 04
type: execute
wave: 3
depends_on: ["41-01", "41-02", "41-03"]
files_modified:
  - App.tsx
  - components/SettingsModal.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User sees info icon (i) button next to at least one feature"
    - "User can trigger tooltip via hover or keyboard focus"
    - "User sees tooltip content explaining feature purpose"
    - "User can trigger tours via button on at least one screen"
    - "Completed tours don't replay on next visit (state persists)"
    - "TourButton visible in app header when on input screen"
  artifacts:
    - path: "App.tsx"
      provides: "TourButton integration with useTour and useTourState wiring"
      contains: "TourButton"
    - path: "components/SettingsModal.tsx"
      provides: "InfoTooltip integration"
      contains: "InfoTooltip"
  key_links:
    - from: "App.tsx"
      to: "components/TourButton.tsx"
      via: "import TourButton"
      pattern: "import.*TourButton.*from"
    - from: "App.tsx"
      to: "hooks/useTour.ts"
      via: "import useTour"
      pattern: "import.*useTour.*from"
    - from: "App.tsx"
      to: "hooks/useTourState.ts"
      via: "import useTourState"
      pattern: "import.*useTourState.*from"
    - from: "components/SettingsModal.tsx"
      to: "components/InfoTooltip.tsx"
      via: "import InfoTooltip"
      pattern: "import.*InfoTooltip.*from"
---

<objective>
Add MINIMAL integration to prove the orphaned tour infrastructure components work.

Purpose: Close the verification gaps identified in 41-VERIFICATION.md. All components (InfoTooltip, TourButton, useTour, useTourState) exist with correct implementations but are orphaned - never imported or used. This plan adds one InfoTooltip instance and one TourButton with a simple 3-step tour to convert "created" status to "established" status.

Output:
- One working InfoTooltip in SettingsModal explaining teleprompter verbosity
- One working TourButton in App header (visible on input screen) with a 3-step landing tour
- Tour completion persists via useTourState wiring
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/41-tour-infrastructure-accessibility/41-VERIFICATION.md
@.planning/phases/41-tour-infrastructure-accessibility/41-01-SUMMARY.md
@.planning/phases/41-tour-infrastructure-accessibility/41-02-SUMMARY.md
@.planning/phases/41-tour-infrastructure-accessibility/41-03-SUMMARY.md
@components/InfoTooltip.tsx
@components/TourButton.tsx
@hooks/useTour.ts
@hooks/useTourState.ts
@App.tsx
@components/SettingsModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add InfoTooltip to SettingsModal verbosity section</name>
  <files>components/SettingsModal.tsx</files>
  <action>
Add ONE InfoTooltip instance to prove the component works.

**Location:** The SettingsModal doesn't have a verbosity selector (that's in App.tsx on the landing page), but the "How to get an API key" accordion section would benefit from an explanation tooltip. Actually, looking at the file, the best candidate is next to the "AI Provider" label since users may wonder why there are only 2 providers.

Add import at top:
```typescript
import { InfoTooltip } from './InfoTooltip';
```

Add InfoTooltip next to "AI Provider" label (around line 187):

Change from:
```typescript
<label className="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">
  AI Provider
</label>
```

To:
```typescript
<label className="flex items-center gap-2 text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">
  AI Provider
  <InfoTooltip content="Gemini is recommended for best results. Claude offers an alternative if you have an Anthropic API key." />
</label>
```

This is the MINIMAL integration needed to prove InfoTooltip works:
- Import is added
- Component renders
- Hover/focus triggers tooltip
- Escape dismisses
- Dark mode works

Do NOT add multiple tooltips - one is sufficient to close the verification gap.
  </action>
  <verify>
1. `npm run typecheck` passes
2. Open Settings modal (click gear icon)
3. See (i) icon next to "AI Provider" label
4. Hover over (i) - tooltip appears explaining providers
5. Tab to (i) - tooltip appears (keyboard focus)
6. Press Escape - tooltip dismisses
7. Toggle dark mode - tooltip colors invert correctly
  </verify>
  <done>InfoTooltip component is WIRED - imported and rendered in SettingsModal with working hover/focus/dismiss behavior.</done>
</task>

<task type="auto">
  <name>Task 2: Add TourButton with demo tour to App header</name>
  <files>App.tsx</files>
  <action>
Add TourButton to App header with a simple 3-step tour demonstrating the infrastructure works.

**Step 1: Add imports near top of file (after existing imports, around line 28):**
```typescript
import { TourButton } from './components/TourButton';
import { useTour } from './hooks/useTour';
import { useTourState } from './hooks/useTourState';
```

**Step 2: Inside the App() function, after the route check (around line 141), add tour state and hook:**
```typescript
// Tour state - persist completion to localStorage
const { isCompleted, markCompleted } = useTourState();

// Define minimal landing tour steps (3 steps to prove progress indicator works)
const landingTourSteps = useMemo(() => [
  {
    element: 'header',
    popover: {
      title: 'Welcome to Cue',
      description: 'This quick tour shows you the basics. Press Next or use arrow keys to continue.',
    },
  },
  {
    element: '[data-tour="upload-zone"]',
    popover: {
      title: 'Upload Your Content',
      description: 'Drop a lesson plan PDF on the left, or an existing presentation on the right.',
    },
  },
  {
    element: '[data-tour="generate-button"]',
    popover: {
      title: 'Generate Your Lesson',
      description: 'Click here to create AI-powered slides with teleprompter scripts. That\'s it!',
    },
  },
], []);

// useTour hook with persistence wiring
const { startTour: startLandingTour, isRunning: isLandingTourRunning } = useTour({
  steps: landingTourSteps,
  onComplete: () => markCompleted('landing'),
});

// Handler that checks completion before starting
const handleStartLandingTour = useCallback(() => {
  // Start regardless of completion - user explicitly requested it
  startLandingTour();
}, [startLandingTour]);
```

**Step 3: Add data-tour attributes to existing elements (for tour targeting):**

Around line 1224-1225, add data-tour to the upload zones container:
```typescript
<div data-tour="upload-zone" className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
```

Around line 1418 (the Generate button area), find the Button that calls handleGenerate and add data-tour:
```typescript
<Button
  data-tour="generate-button"
  className="..."
  onClick={handleGenerate}
  ...
>
```

**Step 4: Add TourButton to header (around line 1116-1117):**

After the logo/title div, before the settings gear, add the TourButton. Modify the header section:

Find this section (around line 1116):
```typescript
<div className="flex items-center gap-4">
     {/* SETTINGS GEAR */}
```

Add TourButton BEFORE the settings gear (only show when on INPUT state):
```typescript
<div className="flex items-center gap-4">
     {/* TOUR BUTTON - only on landing/input screen */}
     {appState === AppState.INPUT && (
       <TourButton onStart={handleStartLandingTour} />
     )}

     {/* SETTINGS GEAR */}
```

This wiring proves:
- TourButton renders and is clickable
- useTour starts a driver.js tour
- Tour shows progress (1 of 3, 2 of 3, 3 of 3)
- Keyboard navigation works (Tab, Enter, Escape)
- useTourState.markCompleted is called on completion
- State persists to localStorage

Do NOT build complete tours for all screens - that's Phase 42-44. This is MINIMAL integration to prove infrastructure.
  </action>
  <verify>
1. `npm run typecheck` passes
2. `npm run dev` starts without errors
3. See "?" button in header when on landing/input screen
4. Click "?" - 3-step tour starts
5. Progress shows "1 of 3", "2 of 3", "3 of 3" as you advance
6. Elements highlight correctly (header, upload zone, generate area)
7. Press Escape mid-tour - tour dismisses (onComplete NOT called)
8. Start tour again, complete all 3 steps - tour completes
9. Check localStorage: `localStorage.getItem('pipi-tour-state')` contains "landing" in completedTours
10. Refresh page - localStorage still has completion state
11. Tour button NOT visible when in EDITING state (only INPUT)
  </verify>
  <done>TourButton + useTour + useTourState are WIRED - full integration from UI trigger through state persistence demonstrated.</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run typecheck` passes
2. `npm run dev` works
3. InfoTooltip renders in SettingsModal and works with hover/focus/escape
4. TourButton renders in header on INPUT screen
5. Clicking TourButton starts 3-step tour with progress indicator
6. Tour completion persists to localStorage (pipi-tour-state key)
7. All orphaned components now have at least one usage:
   - InfoTooltip: imported in SettingsModal
   - TourButton: imported in App.tsx
   - useTour: called in App.tsx
   - useTourState: called in App.tsx
</verification>

<success_criteria>
**Gap Closure Metrics:**
- [x] InfoTooltip integration: One instance rendered and functional
- [x] TourButton integration: Renders in header, triggers tour
- [x] useTour integration: Creates and runs 3-step tour
- [x] useTourState integration: markCompleted called, isCompleted available
- [x] Wiring: useTour.onComplete -> useTourState.markCompleted

**Verification Truths Now Satisfied:**
- User sees info icon (i) button next to AI Provider in Settings
- User can trigger tooltip via hover or keyboard focus
- User sees tooltip content explaining provider choice
- User can trigger tours via button (? in header)
- Completed tours don't replay logic proven (markCompleted wired)
- Tour completion persists across refresh (localStorage proven)

**NOT In Scope (Phase 42-44):**
- Full landing tour with all features
- Editor screen tour
- Presentation screen tour
- Multiple InfoTooltip instances throughout app
</success_criteria>

<output>
After completion, create `.planning/phases/41-tour-infrastructure-accessibility/41-04-SUMMARY.md`
</output>
