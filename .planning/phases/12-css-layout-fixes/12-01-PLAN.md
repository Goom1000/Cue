---
phase: 12-css-layout-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/SlideRenderers.tsx
  - components/PresentationView.tsx
autonomous: true

must_haves:
  truths:
    - "Flowchart arrows are vertically centered with their adjacent boxes"
    - "Flowchart boxes stretch to equal heights (match tallest box)"
    - "Teacher view slide shows complete content without cutoff"
    - "Student view is unaffected by teacher view changes"
  artifacts:
    - path: "components/SlideRenderers.tsx"
      provides: "FlowchartLayout with fixed alignment"
      contains: "items-stretch"
    - path: "components/PresentationView.tsx"
      provides: "Scaled slide container for teacher view"
      contains: "ResizeObserver"
  key_links:
    - from: "components/SlideRenderers.tsx"
      to: "FlowchartLayout"
      via: "items-stretch on flex container"
      pattern: "items-stretch.*justify-center"
    - from: "components/PresentationView.tsx"
      to: "Slide container"
      via: "transform scale with ResizeObserver"
      pattern: "transform.*scale"
---

<objective>
Fix three CSS layout bugs: flowchart arrow alignment, flowchart vertical spacing, and teacher view slide cutoff.

Purpose: Flowcharts currently have misaligned arrows (due to `items-start` and `pb-20` hack) and wasted vertical space (due to fixed `aspect-[4/3]`). Teacher view slide gets cut off because `aspect-video` combined with `h-full` can overflow when teleprompter/controls take space.

Output: Clean flowchart rendering with centered arrows and filled space. Teacher view slide scales to fit available space using ResizeObserver and transform scale.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-css-layout-fixes/12-RESEARCH.md

# Existing code to modify
@components/SlideRenderers.tsx (lines 113-164 - FlowchartLayout)
@components/PresentationView.tsx (lines 619-624 - slide container)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix flowchart arrow alignment and box spacing</name>
  <files>components/SlideRenderers.tsx</files>
  <action>
Modify the FlowchartLayout component (lines 113-164) to fix arrow alignment and box spacing:

1. On line 135, change `items-start` to `items-stretch`:
   - Before: `<div className="flex w-full px-4 gap-4 md:gap-6 flex-1 items-start justify-center">`
   - After: `<div className="flex w-full px-4 gap-4 md:gap-6 flex-1 items-stretch justify-center">`

2. On line 140, remove `h-full pb-20` from the arrow container:
   - Before: `<div className={... shrink-0 flex items-center justify-center h-full pb-20 px-2 ...}>`
   - After: `<div className={... shrink-0 flex items-center justify-center px-2 ...}>`

3. On line 150, remove `aspect-[4/3]` and add `h-full`:
   - Before: `aspect-[4/3] rounded-3xl p-4 md:p-8 flex items-center justify-center ... h-full w-full`
   - After: `h-full rounded-3xl p-4 md:p-8 flex items-center justify-center ... w-full`
   - Note: `h-full` is already present, just remove `aspect-[4/3]`

Why these changes:
- `items-stretch` makes all flex children (boxes AND arrows) stretch to fill cross-axis height
- Removing `pb-20` hack: no longer needed when parent uses `items-stretch` - arrows naturally center
- Removing `aspect-[4/3]`: this constrained box height based on width, causing gaps. Let boxes stretch to fill available height via flexbox
  </action>
  <verify>
Run `npm run build` to verify no TypeScript errors.
Visual verification checklist (for checkpoint):
- Arrows should be vertically centered between boxes
- All boxes should be the same height regardless of content length
- No large gaps below the flowchart boxes
  </verify>
  <done>
FlowchartLayout uses `items-stretch` on flex container, arrow containers have no padding hacks, box containers have no aspect ratio constraint.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix teacher view slide scaling with ResizeObserver</name>
  <files>components/PresentationView.tsx</files>
  <action>
Add a ResizeObserver-based scale calculation to the teacher view slide container (around lines 619-624).

1. At the top of the PresentationView component (after existing refs/state), add:
```typescript
const slideContainerRef = useRef<HTMLDivElement>(null);
const [slideScale, setSlideScale] = useState(1);
```

2. Add a useEffect for ResizeObserver (after existing useEffects):
```typescript
// Scale slide to fit container
useEffect(() => {
  const updateScale = () => {
    if (!slideContainerRef.current) return;
    const container = slideContainerRef.current;
    // Subtract padding (p-4 = 1rem = 16px each side = 32px total)
    const availableWidth = container.clientWidth - 32;
    const availableHeight = container.clientHeight - 32;
    // Fixed slide dimensions (16:9)
    const slideWidth = 1600;
    const slideHeight = 900;
    // Scale to fit while preserving aspect ratio (never scale above 1)
    const scaleX = availableWidth / slideWidth;
    const scaleY = availableHeight / slideHeight;
    setSlideScale(Math.min(scaleX, scaleY, 1));
  };

  updateScale();
  const observer = new ResizeObserver(updateScale);
  if (slideContainerRef.current) observer.observe(slideContainerRef.current);
  return () => observer.disconnect();
}, []);
```

3. Replace the slide container JSX (lines 620-624):
- Before:
```tsx
<div className="flex-1 bg-black relative flex items-center justify-center p-4 min-w-0 min-h-0">
  <div className="w-full h-full max-w-[1600px] aspect-video bg-white rounded-lg overflow-hidden shadow-2xl relative">
    <SlideContentRenderer slide={currentSlide} visibleBullets={visibleBullets} />
  </div>
</div>
```
- After:
```tsx
<div ref={slideContainerRef} className="flex-1 bg-black relative flex items-center justify-center p-4 min-w-0 min-h-0 overflow-hidden">
  <div
    className="bg-white rounded-lg overflow-hidden shadow-2xl"
    style={{
      width: 1600,
      height: 900,
      transform: `scale(${slideScale})`,
      transformOrigin: 'center center'
    }}
  >
    <SlideContentRenderer slide={currentSlide} visibleBullets={visibleBullets} />
  </div>
</div>
```

Key changes:
- Added `ref={slideContainerRef}` to outer container
- Added `overflow-hidden` to outer container (prevents Safari issues)
- Inner div now has fixed dimensions (1600x900) with scale transform
- Removed `w-full h-full max-w-[1600px] aspect-video` which caused overflow
- Uses `transform: scale()` with `transformOrigin: center center` for letterboxing
  </action>
  <verify>
Run `npm run build` to verify no TypeScript errors.
Visual verification checklist (for checkpoint):
- Teacher view slide should be fully visible (no cutoff at bottom or sides)
- Slide should maintain 16:9 aspect ratio (letterboxed if container is different ratio)
- Slide should be centered in the black container area
- Resizing browser window should dynamically adjust slide scale
  </verify>
  <done>
Teacher view slide container uses ResizeObserver with transform scale, slide never overflows container, aspect ratio preserved.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>CSS layout fixes for flowcharts and teacher view slide display</what-built>
  <how-to-verify>
1. Start the dev server: `npm run dev`
2. Open the app and navigate to any presentation with a flowchart slide
3. Verify flowchart layout:
   - Arrows should be vertically centered with boxes (not offset to top)
   - All boxes should be equal height (no shorter boxes)
   - No large gap below the flowchart content
4. Start presentation in teacher view (not student pop-out)
5. Verify teacher view slide:
   - Slide content should be fully visible (no cutoff at bottom or sides)
   - Slide should be centered in the black area
   - Try resizing browser window - slide should dynamically scale
6. Open student view in separate window
7. Verify student view is unchanged (still works correctly)
  </how-to-verify>
  <resume-signal>Type "approved" if all layout fixes work correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- `npm run build` completes without errors
- FlowchartLayout uses `items-stretch` on flex container
- Arrow containers have no padding hacks (`pb-20` removed)
- Box containers have no aspect ratio constraint (`aspect-[4/3]` removed)
- PresentationView has `slideContainerRef` and `slideScale` state
- PresentationView has ResizeObserver useEffect with cleanup
- Slide container uses `transform: scale()` with fixed dimensions
</verification>

<success_criteria>
1. Flowchart arrows are vertically centered with their adjacent boxes
2. Flowchart boxes fill available vertical space without large gaps below content
3. Teacher view slide shows complete content (no cutoff at bottom or sides)
4. Slide maintains 16:9 aspect ratio in teacher view
5. Student view is unaffected by these changes
6. Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-css-layout-fixes/12-01-SUMMARY.md`
</output>
