---
phase: 38-slide-selection-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - App.tsx
autonomous: true

must_haves:
  truths:
    - "Teacher can click checkbox on any slide thumbnail to toggle selection"
    - "Selected slides have visible border highlight distinguishing them"
    - "Toolbar shows 'X of Y selected' count (or prompt when 0 selected)"
    - "Select All button selects every slide in one click"
    - "Deselect All button clears all selections"
    - "Shift+click selects range between last clicked and current"
    - "Cmd/Ctrl+click toggles individual selection"
  artifacts:
    - path: "App.tsx"
      provides: "Slide selection state, checkbox UI, toolbar controls"
      contains: "selectedSlideIds"
  key_links:
    - from: "App.tsx checkbox onClick"
      to: "selectedSlideIds state"
      via: "toggleSelection / selectRange handlers"
      pattern: "setSelectedSlideIds"
    - from: "App.tsx thumbnail className"
      to: "selectedSlideIds.has(slide.id)"
      via: "conditional ring classes"
      pattern: "ring-2.*ring-indigo-600"
---

<objective>
Add slide selection functionality to the editing view sidebar

Purpose: Enable teachers to select slides for Working Wall export (Phase 39)
Output: Checkboxes on thumbnails, selection highlighting, toolbar controls with count
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/38-slide-selection-ui/38-CONTEXT.md
@.planning/phases/38-slide-selection-ui/38-RESEARCH.md
@App.tsx (lines 190-240 for state, 1428-1525 for top bar and sidebar)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add selection state and handlers</name>
  <files>App.tsx</files>
  <action>
Add selection state near other useState declarations (around line 220):

```typescript
// Slide selection state (for Working Wall export)
const [selectedSlideIds, setSelectedSlideIds] = useState<Set<string>>(new Set());
const [lastClickedIndex, setLastClickedIndex] = useState<number | null>(null);
```

Add handler functions after the state declarations:

```typescript
// Selection handlers
const toggleSlideSelection = (slideId: string) => {
  setSelectedSlideIds(prev => {
    const next = new Set(prev);
    if (next.has(slideId)) {
      next.delete(slideId);
    } else {
      next.add(slideId);
    }
    return next;
  });
};

const selectSlideRange = (startIndex: number, endIndex: number) => {
  const start = Math.min(startIndex, endIndex);
  const end = Math.max(startIndex, endIndex);
  const idsToAdd = slides.slice(start, end + 1).map(s => s.id);
  setSelectedSlideIds(prev => {
    const next = new Set(prev);
    idsToAdd.forEach(id => next.add(id));
    return next;
  });
};

const selectAllSlides = () => {
  setSelectedSlideIds(new Set(slides.map(s => s.id)));
};

const deselectAllSlides = () => {
  setSelectedSlideIds(new Set());
  setLastClickedIndex(null);
};

const handleSlideCheckboxClick = (slideId: string, index: number, event: React.MouseEvent) => {
  event.stopPropagation(); // Don't trigger thumbnail click

  // Shift+click: range select from last clicked
  if (event.shiftKey && lastClickedIndex !== null && lastClickedIndex < slides.length) {
    selectSlideRange(lastClickedIndex, index);
    setLastClickedIndex(index);
    return;
  }

  // Cmd/Ctrl+click or plain click: toggle
  toggleSlideSelection(slideId);
  setLastClickedIndex(index);
};
```

Add useEffect to clear selection when slides change (prevents stale selections):

```typescript
// Clear selection when slides array changes (prevents stale selections after delete/reorder)
useEffect(() => {
  setSelectedSlideIds(prev => {
    const validIds = new Set(slides.map(s => s.id));
    const filtered = new Set([...prev].filter(id => validIds.has(id)));
    return filtered.size !== prev.size ? filtered : prev;
  });
}, [slides]);
```

IMPORTANT: Use Set immutably - always create new Set before modifying. Never call set.add() or set.delete() directly on state.
  </action>
  <verify>
TypeScript compiles without errors:
```bash
npx tsc --noEmit
```
  </verify>
  <done>Selection state and handlers exist in App.tsx, TypeScript compiles cleanly</done>
</task>

<task type="auto">
  <name>Task 2: Add checkbox UI and selection highlighting to thumbnails</name>
  <files>App.tsx</files>
  <action>
Modify the slide thumbnail button (around line 1489-1514) to include:

1. Add checkbox overlay in top-left corner of each thumbnail (inside the button, after the opening tag):

```tsx
{/* Selection checkbox */}
<div
  onClick={(e) => handleSlideCheckboxClick(slide.id, idx, e)}
  className="absolute top-1 left-1 z-10"
>
  <div className={`w-5 h-5 rounded border-2 transition-colors cursor-pointer flex items-center justify-center ${
    selectedSlideIds.has(slide.id)
      ? 'bg-indigo-600 dark:bg-amber-500 border-indigo-600 dark:border-amber-500'
      : 'bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600 hover:border-indigo-400 dark:hover:border-amber-400'
  }`}>
    {selectedSlideIds.has(slide.id) && (
      <svg className="w-3 h-3 text-white dark:text-slate-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
      </svg>
    )}
  </div>
</div>
```

2. Add selection ring to the thumbnail button className. Modify the existing className to include selection state:

Change the button className from:
```tsx
className={`w-full group text-left rounded-xl p-3 border transition-all relative ${activeSlideIndex === idx ? '...' : '...'}`}
```

To:
```tsx
className={`w-full group text-left rounded-xl p-3 border transition-all relative ${
  selectedSlideIds.has(slide.id)
    ? 'ring-2 ring-indigo-600 dark:ring-amber-500 ring-offset-2 dark:ring-offset-slate-900'
    : ''
} ${activeSlideIndex === idx
    ? 'bg-white dark:bg-slate-800 border-indigo-600 dark:border-amber-500 shadow-sm ring-1 ring-indigo-100 dark:ring-amber-900/50 translate-x-1'
    : 'bg-white/40 dark:bg-slate-800/30 border-transparent hover:bg-white dark:hover:bg-slate-800 hover:border-slate-200 dark:hover:border-slate-700'
}`}
```

Note: The selection ring (ring-2) is separate from the active state ring (ring-1), allowing both to coexist visually.

IMPORTANT:
- Use stopPropagation on checkbox click to prevent triggering setActiveSlideIndex
- Checkbox is positioned in top-LEFT (not top-right where the question flag already exists)
  </action>
  <verify>
1. Build succeeds: `npm run build`
2. Manual check: Run `npm run dev`, navigate to editing view with slides, verify:
   - Checkboxes appear in top-left of each thumbnail
   - Clicking checkbox toggles selection (border highlight appears)
   - Clicking checkbox does NOT change active slide
   - Shift+click selects range
  </verify>
  <done>Each thumbnail has a checkbox overlay, selected slides show ring highlight, checkbox clicks don't change active slide</done>
</task>

<task type="auto">
  <name>Task 3: Add toolbar controls with selection count</name>
  <files>App.tsx</files>
  <action>
Add selection controls to the top bar (after the Edit Class button section, around line 1462, before the closing div of the top bar):

```tsx
{/* Slide Selection Controls */}
<div className="flex items-center gap-3 ml-4 pl-4 border-l border-slate-200 dark:border-slate-700">
  {selectedSlideIds.size === 0 ? (
    <span className="text-sm text-slate-400 dark:text-slate-500">
      Select slides to export
    </span>
  ) : (
    <span className="text-sm font-medium text-indigo-600 dark:text-amber-500">
      {selectedSlideIds.size} of {slides.length} selected
    </span>
  )}

  <button
    onClick={selectAllSlides}
    className="px-3 py-1.5 text-xs font-bold uppercase tracking-wider text-slate-600 dark:text-slate-400 hover:text-indigo-600 dark:hover:text-amber-500 transition-colors"
  >
    Select All
  </button>

  <button
    onClick={deselectAllSlides}
    className="px-3 py-1.5 text-xs font-bold uppercase tracking-wider text-slate-600 dark:text-slate-400 hover:text-indigo-600 dark:hover:text-amber-500 transition-colors"
  >
    Deselect All
  </button>
</div>
```

This adds:
- Selection count showing "X of Y selected" or prompt text when none selected
- Select All button (always visible per CONTEXT.md decision)
- Deselect All button (always visible per CONTEXT.md decision)
- Visual separator (border-l) between Edit Class button and selection controls
  </action>
  <verify>
1. Build succeeds: `npm run build`
2. Manual verification in browser:
   - Toolbar shows "Select slides to export" when no slides selected
   - Selecting slides updates count to "X of Y selected"
   - Select All button selects all slides
   - Deselect All button clears all selections
   - Count updates immediately (no lag)
  </verify>
  <done>Toolbar displays selection count, Select All and Deselect All buttons work correctly</done>
</task>

</tasks>

<verification>
Run full verification:

1. **Build check:**
   ```bash
   npm run build
   ```
   Expected: No TypeScript or build errors

2. **Functional verification in browser:**
   - [ ] Checkbox visible on every slide thumbnail (top-left corner)
   - [ ] Clicking checkbox toggles selection state
   - [ ] Selected slides show indigo/amber border ring
   - [ ] Clicking checkbox does NOT change active slide
   - [ ] Shift+click selects range between two slides
   - [ ] Cmd/Ctrl+click toggles individual selection
   - [ ] "Select slides to export" shows when 0 selected
   - [ ] "X of Y selected" shows correct count
   - [ ] Select All button selects all slides
   - [ ] Deselect All button clears all selections
   - [ ] Deleting a selected slide removes it from selection
</verification>

<success_criteria>
All five requirements satisfied:
- SEL-01: Toggle selection checkbox on each slide thumbnail
- SEL-02: Selected slides show visual indicator (ring border)
- SEL-03: Selection count displays ("X of Y selected" or prompt)
- SEL-04: "Select All" button works
- SEL-05: "Deselect All" button works
</success_criteria>

<output>
After completion, create `.planning/phases/38-slide-selection-ui/38-01-SUMMARY.md`
</output>
