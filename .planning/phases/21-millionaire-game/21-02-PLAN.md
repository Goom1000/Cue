---
phase: 21-millionaire-game
plan: 02
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - components/games/millionaire/MillionaireQuestion.tsx
  - components/games/MillionaireGame.tsx
  - components/PresentationView.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Teacher can select question count (3, 5, or 10) before starting Millionaire"
    - "Question displays with classic Millionaire blue/purple styling"
    - "Teacher can select an answer and lock it in"
    - "Answer reveal happens with sequential A-B-C-D dramatic timing"
    - "Correct answer advances to next question"
    - "Game progresses through questions until completion or wrong answer"
  artifacts:
    - path: "components/games/millionaire/MillionaireQuestion.tsx"
      provides: "Question display with answer hexagons and sequential reveal"
      exports: ["MillionaireQuestion"]
    - path: "components/games/MillionaireGame.tsx"
      provides: "Full Millionaire teacher view with game flow"
      min_lines: 150
    - path: "components/PresentationView.tsx"
      provides: "launchMillionaire function and question count selection"
      contains: "launchMillionaire"
  key_links:
    - from: "components/games/MillionaireGame.tsx"
      to: "components/games/millionaire/MoneyTree.tsx"
      via: "MoneyTree component import"
      pattern: "import MoneyTree"
    - from: "components/games/MillionaireGame.tsx"
      to: "components/games/millionaire/MillionaireQuestion.tsx"
      via: "MillionaireQuestion component import"
      pattern: "import MillionaireQuestion"
    - from: "components/PresentationView.tsx"
      to: "launchMillionaire function"
      via: "handleSelectGame calling launchMillionaire"
      pattern: "launchMillionaire"
---

<objective>
Build Millionaire question display and core game flow with teacher controls

Purpose: Enable teachers to play through a Millionaire game with question progression, answer selection, and dramatic reveal timing.

Output: MillionaireQuestion component, updated MillionaireGame with full gameplay, and PresentationView integration with question count selection.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-millionaire-game/21-CONTEXT.md
@.planning/phases/21-millionaire-game/21-RESEARCH.md
@.planning/phases/21-millionaire-game/21-01-SUMMARY.md

# Key source files
@types.ts
@components/games/MillionaireGame.tsx
@components/games/QuickQuizGame.tsx
@components/PresentationView.tsx
@components/games/millionaire/millionaireConfig.ts
@components/games/millionaire/MoneyTree.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MillionaireQuestion component with answer selection and reveal</name>
  <files>components/games/millionaire/MillionaireQuestion.tsx</files>
  <action>
  Create components/games/millionaire/MillionaireQuestion.tsx with:

  1. Question text display in Millionaire style (blue/purple gradient, hexagon-shaped answer options)

  2. Answer options A, B, C, D displayed as horizontal bars with:
     - Letter label on left (A, B, C, D)
     - Answer text
     - Classic Millionaire blue/purple gradient background
     - Hover state for selection (before locked in)
     - Selected state (amber highlight)

  3. Sequential reveal animation state:
     - Track revealedCount (0-4) and isRevealing state
     - When revealing: options become opaque one by one (300ms between each)
     - After all revealed (800ms pause), show correct/incorrect result

  4. Props interface:
     ```typescript
     interface MillionaireQuestionProps {
       question: QuizQuestion;
       selectedOption: number | null;
       eliminatedOptions: number[];
       onSelectOption: (idx: number) => void;
       onLockIn: () => void;
       isLocked: boolean;
       revealState: {
         isRevealing: boolean;
         revealedCount: number;
         showResult: boolean;
       };
     }
     ```

  5. Visual requirements per CONTEXT.md:
     - Classic Millionaire blue/purple color scheme (bg-blue-950, bg-indigo-900, purple accents)
     - Eliminated options (from 50:50) should be hidden/grayed out
     - Selected option highlighted in amber before lock-in
     - After lock-in during reveal: dramatic sequential highlight
     - Correct answer: green glow, checkmark
     - Wrong answer: red flash (if selected wrong)

  Do NOT use assertNever - project has TypeScript non-strict mode.
  </action>
  <verify>Component renders without errors, answer options display correctly with selection state</verify>
  <done>MillionaireQuestion displays question text and 4 answer options with selection, lock-in, elimination, and reveal states</done>
</task>

<task type="auto">
  <name>Task 2: Rebuild MillionaireGame with full gameplay flow</name>
  <files>components/games/MillionaireGame.tsx</files>
  <action>
  Replace the placeholder MillionaireGame.tsx with full implementation:

  1. Import required components:
     - MoneyTree from './millionaire/MoneyTree'
     - MillionaireQuestion from './millionaire/MillionaireQuestion'
     - MONEY_TREE_CONFIGS, getSafeHavenAmount from './millionaire/millionaireConfig'
     - ResultScreen from './shared/ResultScreen'

  2. Props interface:
     ```typescript
     interface MillionaireGameProps {
       state: MillionaireState;
       onClose: () => void;
       onSelectOption: (idx: number) => void;
       onLockIn: () => void;
       onNextQuestion: () => void;
       onUseLifeline: (lifeline: 'fiftyFifty' | 'askTheAudience' | 'phoneAFriend') => void;
       onRestart?: () => void;
     }
     ```

  3. Local state for reveal animation:
     - revealState: { isRevealing: boolean; revealedCount: number; showResult: boolean }
     - Trigger reveal sequence when isLocked and answer not yet revealed

  4. Reveal sequence logic (300ms between options, 800ms before result):
     ```typescript
     useEffect(() => {
       if (state.status === 'reveal' && !revealState.isRevealing && !revealState.showResult) {
         // Start reveal sequence
         setRevealState(prev => ({ ...prev, isRevealing: true }));

         // Reveal A, B, C, D sequentially
         const revealNext = (count: number) => {
           if (count < 4) {
             setTimeout(() => {
               setRevealState(prev => ({ ...prev, revealedCount: count + 1 }));
               revealNext(count + 1);
             }, 300);
           } else {
             // All revealed, pause then show result
             setTimeout(() => {
               setRevealState(prev => ({ ...prev, showResult: true, isRevealing: false }));
             }, 800);
           }
         };
         revealNext(0);
       }
     }, [state.status, revealState]);
     ```

  5. Layout: Two-column design
     - Left side (30%): MoneyTree component
     - Right side (70%): MillionaireQuestion + controls
     - Bottom: Lifeline buttons (will be functional in Plan 03)

  6. Result screen when status === 'result':
     - Show victory celebration if all questions answered
     - Show wrong answer result with safe haven amount if wrong

  7. Teacher controls below question:
     - "Lock In" button (disabled if no option selected)
     - "Next Question" button (shown after reveal, advances to next)
     - "End Game" button

  Keep layout consistent with existing game styling (bg-slate-900, rounded corners, shadows).
  </action>
  <verify>`npm run build` succeeds, component renders without errors</verify>
  <done>MillionaireGame displays Money Tree, question with selection, and handles reveal sequence with teacher controls</done>
</task>

<task type="auto">
  <name>Task 3: Add launchMillionaire to PresentationView with question count selection</name>
  <files>components/PresentationView.tsx</files>
  <action>
  Update PresentationView.tsx to add Millionaire game launch:

  1. Add state for question count selection modal:
     ```typescript
     const [showMillionaireSetup, setShowMillionaireSetup] = useState(false);
     ```

  2. Create createMillionaireState factory (similar to createQuickQuizState):
     ```typescript
     const createMillionaireState = useCallback((
       questions: QuizQuestion[],
       questionCount: 3 | 5 | 10
     ): MillionaireState => {
       const config = MONEY_TREE_CONFIGS[questionCount];
       return {
         gameType: 'millionaire',
         status: 'playing',
         questions,
         currentQuestionIndex: 0,
         selectedOption: null,
         lifelines: {
           fiftyFifty: true,
           phoneAFriend: true,
           askTheAudience: true,
         },
         prizeLadder: config.prizes,
         currentPrize: 0,
         eliminatedOptions: [],
         audiencePoll: null,
         phoneHint: null,
         safeHavenAmount: 0,
         questionCount,
       };
     }, []);
     ```

  3. Create launchMillionaire function:
     ```typescript
     const launchMillionaire = useCallback(async (questionCount: 3 | 5 | 10) => {
       if (!provider) {
         onRequestAI('start the Millionaire game');
         return;
       }

       // Set loading state with question count
       setActiveGame({
         ...createMillionaireState([], questionCount),
         status: 'loading',
       });

       try {
         const questions = await generateImpromptuQuiz(
           provider.apiKey,
           slides,
           currentIndex,
           questionCount
         );
         setActiveGame(createMillionaireState(questions, questionCount));
       } catch (e) {
         console.error(e);
         if (e instanceof AIProviderError) {
           onError('Quiz Generation Failed', e.userMessage);
         } else {
           onError('Quiz Generation Failed', 'An unexpected error occurred');
         }
         setActiveGame(null);
       }
     }, [provider, slides, currentIndex, createMillionaireState, onRequestAI, onError]);
     ```

  4. Update handleSelectGame to show setup modal for Millionaire:
     ```typescript
     case 'millionaire':
       setShowMillionaireSetup(true);
       break;
     ```

  5. Add simple setup modal (inline, not separate component):
     - Three buttons: "3 Questions", "5 Questions", "10 Questions"
     - Clicking calls launchMillionaire(count) and closes modal
     - Cancel button to dismiss
     - Modal overlay similar to existing modals in codebase

  6. Add Millionaire-specific control handlers:
     ```typescript
     const handleMillionaireSelectOption = useCallback((idx: number) => {
       if (activeGame?.gameType === 'millionaire' && activeGame.status === 'playing') {
         setActiveGame(prev => prev ? { ...prev, selectedOption: idx } : null);
       }
     }, [activeGame]);

     const handleMillionaireLockIn = useCallback(() => {
       if (activeGame?.gameType === 'millionaire' && activeGame.selectedOption !== null) {
         setActiveGame(prev => prev ? { ...prev, status: 'reveal' as const } : null);
       }
     }, [activeGame]);

     const handleMillionaireNext = useCallback(() => {
       if (activeGame?.gameType !== 'millionaire') return;
       const state = activeGame;
       const currentQuestion = state.questions[state.currentQuestionIndex];
       const isCorrect = state.selectedOption === currentQuestion.correctAnswerIndex;

       if (isCorrect) {
         // Advance to next question or victory
         if (state.currentQuestionIndex < state.questions.length - 1) {
           const config = MONEY_TREE_CONFIGS[state.questionCount];
           const newIndex = state.currentQuestionIndex + 1;
           setActiveGame({
             ...state,
             currentQuestionIndex: newIndex,
             selectedOption: null,
             status: 'playing',
             currentPrize: state.prizeLadder[state.currentQuestionIndex],
             safeHavenAmount: getSafeHavenAmount(newIndex, config),
             eliminatedOptions: [],
             audiencePoll: null,
             phoneHint: null,
           });
         } else {
           // Victory!
           setActiveGame({
             ...state,
             status: 'result',
             currentPrize: state.prizeLadder[state.currentQuestionIndex],
           });
         }
       } else {
         // Wrong answer - game over, fall to safe haven
         setActiveGame({
           ...state,
           status: 'result',
           currentPrize: state.safeHavenAmount,
         });
       }
     }, [activeGame]);
     ```

  7. Pass new handlers to GameContainer (update props for MillionaireGame).

  Import MONEY_TREE_CONFIGS and getSafeHavenAmount from './games/millionaire/millionaireConfig'.
  </action>
  <verify>`npm run build` succeeds, Millionaire can be selected from menu and shows question count setup modal</verify>
  <done>Teacher can select Millionaire from game menu, choose question count, and play through with answer selection, lock-in, reveal, and progression</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds without TypeScript errors
2. Selecting Millionaire from GameMenu shows question count selection (3, 5, 10)
3. Choosing a count generates questions and starts game
4. Money Tree displays on left with correct prizes for chosen count
5. Teacher can click answer option to select, click Lock In to confirm
6. Reveal sequence shows A-B-C-D sequentially with timing
7. Correct answer advances to next question
8. Wrong answer ends game and shows safe haven amount
9. Victory screen shows when all questions answered correctly
</verification>

<success_criteria>
- Millionaire launches with question count selection (3, 5, or 10)
- Question display shows classic Millionaire styling
- Answer selection, lock-in, and sequential reveal work
- Money Tree updates as questions are answered
- Game progresses correctly (advance on correct, end on wrong with safe haven)
- Victory/loss result screens display appropriate outcomes
</success_criteria>

<output>
After completion, create `.planning/phases/21-millionaire-game/21-02-SUMMARY.md`
</output>
