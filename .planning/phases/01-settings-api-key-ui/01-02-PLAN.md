---
phase: 01-settings-api-key-ui
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - components/SettingsModal.tsx
  - App.tsx
autonomous: false

must_haves:
  truths:
    - "User can open settings panel via gear icon in header"
    - "User can select AI provider from dropdown"
    - "User can enter API key with show/hide toggle"
    - "User can test API key and see success/error feedback"
    - "User can only save after successful test"
    - "User sees collapsible setup instructions per provider"
    - "User sees stored locally only notice"
    - "User can clear all data via type-to-confirm"
    - "Settings persist across browser refresh"
  artifacts:
    - path: "components/SettingsModal.tsx"
      provides: "Complete settings modal UI"
      min_lines: 200
    - path: "App.tsx"
      provides: "Gear icon in header, modal state management"
      contains: "showSettings"
  key_links:
    - from: "components/SettingsModal.tsx"
      to: "hooks/useSettings.ts"
      via: "import useSettings hook"
      pattern: "import.*useSettings.*from.*hooks"
    - from: "components/SettingsModal.tsx"
      to: "services/apiValidation.ts"
      via: "import validateApiKey"
      pattern: "import.*validateApiKey.*from.*services"
    - from: "App.tsx"
      to: "components/SettingsModal.tsx"
      via: "import and render SettingsModal"
      pattern: "<SettingsModal"
---

<objective>
Build the complete Settings modal UI with all required functionality and integrate it into the app header.

Purpose: Deliver the user-facing settings experience - provider selection, API key entry with validation, setup instructions, security notice, and data clearing. This completes Phase 1 requirements.

Output: SettingsModal component with full functionality, integrated via gear icon in the header.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-settings-api-key-ui/01-CONTEXT.md
@.planning/phases/01-settings-api-key-ui/01-RESEARCH.md

# Prior plan summary (types, hook, validation):
@.planning/phases/01-settings-api-key-ui/01-01-SUMMARY.md

# UI patterns to follow:
@components/ResourceHub.tsx
@App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SettingsModal component</name>
  <files>components/SettingsModal.tsx</files>
  <action>
Create components/SettingsModal.tsx following the ResourceHub modal pattern.

Props interface:
- onClose: () => void

Structure (top to bottom):

1. **Modal Container** (fixed inset-0 overlay with backdrop blur, following ResourceHub line 221)

2. **Modal Panel** (centered, max-w-xl, rounded-3xl, following ResourceHub pattern)
   - Header: "Settings" title + close X button
   - Content area with sections below

3. **Provider Selection Section**
   - Label: "AI Provider"
   - Dropdown/select with options: Gemini (default), OpenAI, Claude
   - Use native <select> with Tailwind styling (bg-slate-50 dark:bg-slate-800, rounded-xl, etc.)

4. **API Key Section**
   - Label: "API Key"
   - Password input field with eye icon toggle (per CONTEXT: hidden by default)
   - Test Connection button (inline, right of field or below)
   - Status feedback area below field:
     - Loading state: spinner + "Testing..."
     - Success: green checkmark + "API key is valid"
     - Error: red X + error message from validation
   - Per CONTEXT: validation only on Test button click (not on blur)

5. **Setup Instructions Accordion**
   - Collapsible section (click to expand/collapse)
   - Header: "How to get an API key" with chevron icon
   - Content changes based on selected provider:

     Gemini:
     ```
     1. Go to Google AI Studio
     2. Click "Get API Key"
     3. Create or copy existing key
     Cost: Free tier (15 req/min), paid ~$0.075/1M tokens
     ```
     Button: "Open Google AI Studio" -> https://aistudio.google.com/app/apikey

     OpenAI:
     ```
     1. Go to platform.openai.com
     2. Navigate to API Keys
     3. Create new secret key
     Cost: ~$0.15/1M tokens, requires $5 credit
     ```
     Button: "Open OpenAI Dashboard" -> https://platform.openai.com/api-keys

     Claude:
     ```
     1. Go to console.anthropic.com
     2. Navigate to API Keys
     3. Create new key
     Cost: ~$0.25/1M tokens, requires $5 credit
     ```
     Button: "Open Anthropic Console" -> https://console.anthropic.com/settings/keys

   - Use Tailwind transitions for expand/collapse animation (max-h-0 to max-h-[500px], overflow-hidden)

6. **Footer Section**
   - Save button (disabled until test passes, per CONTEXT: "Require successful test before saving")
   - Cancel button
   - Security notice: small text "Your API key is stored locally in your browser only"

7. **Danger Zone Section** (at bottom, visually separated)
   - "Clear All Data" heading
   - Type-to-confirm input (per CONTEXT: user must type 'delete')
   - Clear button (disabled until confirmText === 'delete')
   - Clears settings only (not current presentation, per CONTEXT)

State management:
- Local state for form fields (provider, apiKey, showKey, confirmText)
- Local state for test status (idle, testing, success, error + message)
- Local state for accordion expanded
- Track if key has been tested and passed (for Save button enable)
- useSettings hook for loading initial values and saving

Behavior:
- On open: load current settings into local form state
- On provider change: reset test status (new provider = need new test)
- On Test click: call validateApiKey, update status
- On Save click: call updateSettings from hook, call onClose
- On Cancel click: discard changes, call onClose
- On Clear click: call clearSettings from hook, reset form to defaults
  </action>
  <verify>TypeScript compiles: `cd "/Users/ricky/Documents/App_Projects/Education Apps/DEV - PiPi" && npx tsc --noEmit`</verify>
  <done>SettingsModal.tsx exists with all sections: provider dropdown, API key field with toggle, test button with status, accordion instructions, Save/Cancel, security notice, danger zone</done>
</task>

<task type="auto">
  <name>Task 2: Add gear icon to header and wire modal</name>
  <files>App.tsx</files>
  <action>
Modify App.tsx to add settings access:

1. Add import for SettingsModal:
   `import SettingsModal from './components/SettingsModal';`

2. Add state for modal visibility (near other modal state like showResourceHub):
   `const [showSettings, setShowSettings] = useState(false);`

3. Add gear icon button in header, positioned BEFORE the dark mode toggle (line ~281):
   - Use same button styling as dark mode toggle (p-2 rounded-lg bg-slate-100 dark:bg-slate-800...)
   - Gear SVG icon (from RESEARCH.md code example):
     ```
     <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.573-1.066z" />
     <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
     ```
   - onClick={() => setShowSettings(true)}
   - title="Settings"

4. Render SettingsModal conditionally (near showResourceHub rendering, around line 313):
   ```tsx
   {showSettings && (
     <SettingsModal onClose={() => setShowSettings(false)} />
   )}
   ```

5. Gear icon should be visible in ALL app states (INPUT, PROCESSING_TEXT, EDITING) - place it in the header section that's always visible.
  </action>
  <verify>
1. TypeScript compiles: `cd "/Users/ricky/Documents/App_Projects/Education Apps/DEV - PiPi" && npx tsc --noEmit`
2. Dev server runs: `cd "/Users/ricky/Documents/App_Projects/Education Apps/DEV - PiPi" && npm run dev` (check for errors)
  </verify>
  <done>Gear icon appears in header, clicking opens SettingsModal, close button dismisses it</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Settings panel with:
- Gear icon in header (next to dark mode toggle)
- Modal with provider dropdown, API key field, test button
- Collapsible setup instructions per provider
- Save/Cancel buttons (Save disabled until test passes)
- Security notice and danger zone with type-to-confirm
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open http://localhost:5173 in browser
3. Verify gear icon appears in header (should be next to sun/moon icon)
4. Click gear icon - settings modal should open
5. Test provider dropdown - should have Gemini, OpenAI, Claude options
6. Test API key field:
   - Should be masked by default (password field)
   - Eye icon should toggle visibility
7. Test the Test Connection button:
   - With empty key: should show error
   - With invalid key: should show "Invalid API key" error
   - (Optional) With valid key: should show green success
8. Verify Save button is disabled until test passes
9. Test accordion - click to expand/collapse instructions
10. Verify instructions change when provider changes
11. Verify "stored locally only" notice appears
12. Test danger zone:
    - Type 'delete' in the confirm field
    - Clear button should become enabled
    - (Don't click unless you want to clear)
13. Close modal via X button or Cancel
14. Refresh page - settings should persist (if you saved any)
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npx tsc --noEmit` passes
2. `npm run dev` starts without errors
3. All Phase 1 requirements verified via checkpoint
</verification>

<success_criteria>
Requirements coverage:
- SETT-01: User can open settings panel via gear icon [verified in checkpoint]
- SETT-02: User can select AI provider (Gemini, Claude, OpenAI) [verified in checkpoint]
- SETT-03: User can enter API key with show/hide toggle [verified in checkpoint]
- SETT-04: User can test API key with test button [verified in checkpoint]
- SETT-05: Security notice displayed [verified in checkpoint]
- SETT-06: User can clear all data [verified in checkpoint]
- SETT-07: Settings persist in localStorage [verified in checkpoint]
- INST-01: Setup instructions in settings [verified in checkpoint]
- INST-02: Cost information included [verified in checkpoint]
- INST-03: Direct links to provider API pages [verified in checkpoint]
</success_criteria>

<output>
After completion, create `.planning/phases/01-settings-api-key-ui/01-02-SUMMARY.md`
</output>
