---
phase: 10-class-bank-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - types.ts
  - hooks/useClassBank.ts
  - components/ClassBankSaveModal.tsx
autonomous: true

must_haves:
  truths:
    - "Teacher can save current student list with a custom name"
    - "Saved classes persist in localStorage and survive browser close"
    - "Duplicate class names prompt for replacement confirmation"
  artifacts:
    - path: "types.ts"
      provides: "SavedClass interface"
      contains: "interface SavedClass"
    - path: "hooks/useClassBank.ts"
      provides: "localStorage persistence hook"
      exports: ["useClassBank", "CLASS_BANK_KEY"]
    - path: "components/ClassBankSaveModal.tsx"
      provides: "Modal for naming and saving classes"
      exports: ["ClassBankSaveModal"]
  key_links:
    - from: "hooks/useClassBank.ts"
      to: "localStorage"
      via: "getItem/setItem with CLASS_BANK_KEY"
      pattern: "localStorage\\.(get|set)Item.*CLASS_BANK_KEY"
    - from: "hooks/useClassBank.ts"
      to: "types.ts"
      via: "SavedClass import"
      pattern: "import.*SavedClass.*from"
---

<objective>
Create the data persistence layer and save UI for the class bank feature.

Purpose: Enable teachers to save their current student list with a custom name. This establishes the foundation for class reuse across presentations.

Output: useClassBank hook for localStorage persistence, SavedClass type definition, and ClassBankSaveModal component for the save flow.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-class-bank-core/10-CONTEXT.md
@.planning/phases/10-class-bank-core/10-RESEARCH.md

Key patterns to follow:
- hooks/useSettings.ts (localStorage hook pattern with validation)
- components/RecoveryModal.tsx (modal structure and styling)
- components/Toast.tsx (useToast hook usage)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SavedClass type and useClassBank hook</name>
  <files>types.ts, hooks/useClassBank.ts</files>
  <action>
1. In types.ts, add SavedClass interface after PiPiFile interface:
```typescript
// Class Bank - saved student lists
export interface SavedClass {
  id: string;           // crypto.randomUUID()
  name: string;         // User-provided name (trimmed)
  students: string[];   // Array of student names
  savedAt: string;      // ISO 8601 timestamp
}
```

2. Create hooks/useClassBank.ts following useSettings.ts pattern:
- Export `CLASS_BANK_KEY = 'pipi-class-bank'`
- Create `isValidSavedClass(data: unknown): data is SavedClass` type guard
- Create `readClassesFromStorage(): SavedClass[]` with try/catch and validation
- Export `useClassBank()` hook returning:
  - `classes: SavedClass[]` - all saved classes
  - `saveClass(name: string, students: string[]): void` - saves or updates class
  - `deleteClass(classId: string): void` - removes class by ID
  - `getClassByName(name: string): SavedClass | undefined` - for duplicate check
- Use useEffect to persist to localStorage on classes change
- Handle QuotaExceededError in try/catch (console.warn)
- Trim name before saving, generate UUID for new classes
  </action>
  <verify>
- `grep -n "SavedClass" types.ts` shows interface
- `grep -n "CLASS_BANK_KEY" hooks/useClassBank.ts` shows key
- File compiles without TypeScript errors: `npx tsc --noEmit`
  </verify>
  <done>SavedClass type exists. useClassBank hook exports saveClass, deleteClass, getClassByName functions with localStorage persistence.</done>
</task>

<task type="auto">
  <name>Task 2: Create ClassBankSaveModal component</name>
  <files>components/ClassBankSaveModal.tsx</files>
  <action>
Create components/ClassBankSaveModal.tsx with props:
```typescript
interface ClassBankSaveModalProps {
  onSave: (name: string) => void;
  onClose: () => void;
  existingNames: string[];  // For duplicate detection
}
```

Modal structure (follow RecoveryModal.tsx pattern):
1. Fixed overlay: `fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-6 animate-fade-in`
2. Modal card: `bg-white dark:bg-slate-900 w-full max-w-md rounded-3xl shadow-2xl border border-slate-200 dark:border-slate-700`
3. Header with icon (folder/save icon), title "Save Class"
4. Input field for class name:
   - Placeholder: "e.g., Period 1 Math"
   - Auto-focus on mount
   - Show character count or validation hint below
5. Save button (disabled when name is empty or whitespace-only)
6. Cancel button

Behavior:
- On Enter key in input: trigger save if valid
- On save: trim name, check if exists in existingNames
  - If duplicate: `window.confirm("A class with this name exists. Replace it?")` - only call onSave if confirmed
  - If new: call onSave directly
- On Escape key: call onClose
- Use `name.trim()` for all validation (not just empty string check)

Styling: Match RecoveryModal.tsx colors (indigo-600/amber-500 primary buttons, dark mode support)
  </action>
  <verify>
- File exists: `ls components/ClassBankSaveModal.tsx`
- Exports component: `grep -n "export" components/ClassBankSaveModal.tsx`
- Has dark mode classes: `grep -n "dark:" components/ClassBankSaveModal.tsx`
  </verify>
  <done>ClassBankSaveModal renders with name input, validates empty/whitespace, prompts on duplicate names, matches existing modal styling.</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Hook can be imported: Add temporary `import { useClassBank } from './hooks/useClassBank'` to App.tsx and verify no errors
3. Modal can be imported: Add temporary `import ClassBankSaveModal from './components/ClassBankSaveModal'` to App.tsx and verify no errors
</verification>

<success_criteria>
- SavedClass interface defined in types.ts
- useClassBank hook persists to localStorage with CLASS_BANK_KEY
- ClassBankSaveModal displays properly styled modal with name input
- Save button disabled for empty/whitespace names
- Duplicate name detection prompts window.confirm
- All files compile without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-class-bank-core/10-01-SUMMARY.md`
</output>
