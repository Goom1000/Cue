---
phase: 11-class-management-ui
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - components/ClassManagementModal.tsx
  - components/ClassBankDropdown.tsx
  - App.tsx
autonomous: true

must_haves:
  truths:
    - "Teacher can view list of all saved classes with names and student counts"
    - "Teacher can search/filter classes by name"
    - "Teacher can rename a class by clicking its name (inline edit)"
    - "Teacher can edit students within a class (expand in place)"
    - "Teacher can delete a class with confirmation and undo via toast"
    - "Deleting or renaming the currently-loaded class updates the active class indicator"
  artifacts:
    - path: "components/ClassManagementModal.tsx"
      provides: "Modal for viewing, renaming, editing, deleting classes"
      min_lines: 150
    - path: "components/ClassBankDropdown.tsx"
      provides: "Manage Classes entry point"
      contains: "Manage Classes"
    - path: "App.tsx"
      provides: "ClassManagementModal integration with active class sync"
      contains: "ClassManagementModal"
  key_links:
    - from: "components/ClassManagementModal.tsx"
      to: "hooks/useClassBank.ts"
      via: "renameClass, updateClassStudents, deleteClass callbacks"
      pattern: "onRename|onUpdateStudents|onDelete"
    - from: "components/ClassBankDropdown.tsx"
      to: "components/ClassManagementModal.tsx"
      via: "Manage Classes button triggers onManage callback"
      pattern: "onManage"
    - from: "App.tsx"
      to: "components/ClassManagementModal.tsx"
      via: "showManageModal state and activeClassName sync"
      pattern: "showManageModal|setActiveClassName"
---

<objective>
Create ClassManagementModal component for viewing, renaming, editing students, and deleting classes. Add entry point to ClassBankDropdown and integrate with App.tsx including active class sync.

Purpose: Complete the class management UI allowing teachers to manage their saved class rosters.

Output: Fully functional class management modal accessible via "Manage Classes..." option in load dropdown.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-class-management-ui/11-CONTEXT.md
@.planning/phases/11-class-management-ui/11-RESEARCH.md
@.planning/phases/11-class-management-ui/11-01-SUMMARY.md (will exist after Plan 01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ClassManagementModal component</name>
  <files>components/ClassManagementModal.tsx</files>
  <action>
Create a new modal component for managing saved classes. Follow existing modal patterns from ClassBankSaveModal and RecoveryModal.

Props interface:
```typescript
interface ClassManagementModalProps {
  classes: SavedClass[];
  onClose: () => void;
  onRename: (classId: string, newName: string) => void;
  onUpdateStudents: (classId: string, students: string[]) => void;
  onDelete: (classId: string, className: string) => void;
  activeClassName: string | null;
}
```

Features to implement:

1. **Modal Container**
   - Fixed overlay with dark backdrop (existing pattern)
   - Centered modal card, max-w-lg, rounded-3xl
   - Close on Escape key
   - Allow backdrop click to close (consistent with other modals)

2. **Header**
   - Icon (folder or users icon)
   - Title: "Manage Classes"
   - Subtitle: "View, rename, or delete your saved classes"

3. **Search Input** (at top of list)
   - Placeholder: "Search classes..."
   - Filter classes by name as user types
   - Use existing input styling patterns

4. **Class List**
   - Sort alphabetically by name (useMemo)
   - Apply search filter (useMemo)
   - Scrollable container (max-h-80 overflow-y-auto)
   - Show "No matching classes" when filter returns empty
   - Show "No saved classes" when classes array is empty

5. **Class Row** (for each class)
   - Display class name (inline editable)
   - Display student count: "24 students" (or "1 student")
   - Edit Students button (pencil icon) - toggles expand
   - Delete button (trash icon) - with confirmation

6. **Inline Name Editing**
   - Click on name to enter edit mode
   - Show input field with current name
   - Auto-focus input
   - Save on blur or Enter
   - Cancel on Escape (revert to original)
   - Validate: non-empty after trim
   - Call onRename(classId, newName) on save

7. **Expand-in-Place Student Editing**
   - Track expandedClassId state (only one expanded at a time)
   - When expanded, show student list below the row
   - Display students as removable chips (like in App.tsx student bar)
   - Add student input with add button
   - Remove student: filter out from array, call onUpdateStudents
   - Add student: append to array, call onUpdateStudents
   - Collapse when clicking Edit Students again or on another row

8. **Delete with Confirmation**
   - Use window.confirm('Delete this class?') per CONTEXT.md
   - Call onDelete(classId, className) if confirmed
   - Parent (App.tsx) handles toast with undo

9. **Active Class Indicator**
   - If class.name === activeClassName, show subtle indicator (e.g., small dot or "(active)" text)
   - Helps user know which class is currently loaded

10. **Close Button**
    - "Done" button at bottom to close modal
    - Or X button in header corner

Styling: Follow existing Tailwind patterns with dark mode support. Use indigo/amber accent colors.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Component renders list of classes
Inline rename works (click name, edit, blur saves)
Expand-in-place student editing works
Delete shows confirmation
  </verify>
  <done>
ClassManagementModal displays all saved classes with search, inline rename, expand-in-place student editing, and delete with confirmation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Manage Classes entry point to ClassBankDropdown</name>
  <files>components/ClassBankDropdown.tsx</files>
  <action>
Add "Manage Classes..." option at the bottom of the ClassBankDropdown.

1. Add new prop to ClassBankDropdownProps:
```typescript
interface ClassBankDropdownProps {
  classes: SavedClass[];
  onLoad: (classData: SavedClass) => void;
  onClose: () => void;
  onManage: () => void;  // NEW
}
```

2. Add footer section after class list:
   - Divider line (border-t)
   - "Manage Classes..." button
   - Settings/gear icon or folder-open icon
   - Subtle styling (lighter text, smaller)
   - onClick calls onManage() then onClose()

3. Only show "Manage Classes..." when there are saved classes (classes.length > 0)
   - Per CONTEXT.md: "Option only appears when there are saved classes"

Layout:
```
Load Class (header)
---
Class 1 (24 students)
Class 2 (18 students)
...
---
Manage Classes... (footer, only if classes exist)
```
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Dropdown shows "Manage Classes..." when classes exist
Clicking opens management modal (tested in Task 3)
  </verify>
  <done>
ClassBankDropdown has "Manage Classes..." option at bottom that triggers onManage callback.
Option only appears when saved classes exist.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate ClassManagementModal into App.tsx</name>
  <files>App.tsx</files>
  <action>
Add ClassManagementModal to App.tsx with full integration including active class sync.

1. **Add import:**
```typescript
import ClassManagementModal from './components/ClassManagementModal';
```

2. **Add state:**
```typescript
const [showManageModal, setShowManageModal] = useState(false);
```

3. **Update useClassBank destructuring:**
```typescript
const { classes, saveClass, deleteClass, getClassByName, renameClass, updateClassStudents } = useClassBank();
```

4. **Create handler functions:**

```typescript
// Handle rename with active class sync
const handleRenameClass = (classId: string, newName: string) => {
  // Find the class being renamed
  const targetClass = classes.find(c => c.id === classId);

  // If this is the currently active class, update activeClassName
  if (targetClass && targetClass.name === activeClassName) {
    setActiveClassName(newName);
  }

  renameClass(classId, newName);
};

// Handle student update
const handleUpdateClassStudents = (classId: string, students: string[]) => {
  updateClassStudents(classId, students);
};

// Handle delete with toast undo
const handleDeleteClass = (classId: string, className: string) => {
  // Store for potential undo
  const deletedClass = classes.find(c => c.id === classId);

  // Clear activeClassName if deleting the active class
  if (className === activeClassName) {
    setActiveClassName(null);
  }

  // Delete the class
  deleteClass(classId);

  // Show toast with undo option
  addToast(
    `Deleted "${className}"`,
    5000,
    'info',
    {
      label: 'Undo',
      onClick: () => {
        if (deletedClass) {
          // Re-save the class (will create with same data)
          saveClass(deletedClass.name, deletedClass.students);
          addToast(`Restored "${deletedClass.name}"`, 3000, 'success');
        }
      }
    }
  );
};
```

5. **Update ClassBankDropdown usage** (in the editing state section around line 1007):
```tsx
{showLoadDropdown && (
  <ClassBankDropdown
    classes={classes}
    onLoad={handleLoadClassBank}
    onClose={() => setShowLoadDropdown(false)}
    onManage={() => {
      setShowLoadDropdown(false);
      setShowManageModal(true);
    }}
  />
)}
```

6. **Add ClassManagementModal render** (after ClassBankSaveModal, around line 1264):
```tsx
{/* Class Bank Management Modal */}
{showManageModal && (
  <ClassManagementModal
    classes={classes}
    onClose={() => setShowManageModal(false)}
    onRename={handleRenameClass}
    onUpdateStudents={handleUpdateClassStudents}
    onDelete={handleDeleteClass}
    activeClassName={activeClassName}
  />
)}
```

7. **Note on undo edge case:**
   - The undo restores via saveClass, which creates a new ID
   - This is acceptable - the class data is restored, just with new ID
   - Alternative (more complex): Store full class object and have a restoreClass function
   - Keep simple per project philosophy
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Vite builds successfully: `npm run build`
Manual test flow:
1. Load a class -> shows as active
2. Open Manage Classes
3. Rename the active class -> activeClassName updates
4. Delete the active class -> activeClassName clears, toast shows undo
5. Click undo -> class restored
  </verify>
  <done>
ClassManagementModal integrated into App.tsx.
"Manage Classes..." in dropdown opens modal.
Renaming active class updates activeClassName.
Deleting active class clears activeClassName.
Delete shows toast with working undo.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. Vite builds successfully: `npm run build`
3. App loads without console errors: `npm run dev`
4. Manual verification of all CLASS requirements:
   - CLASS-05: Open dropdown -> Manage Classes -> see all classes with student counts
   - CLASS-06: Click class name -> edit inline -> blur to save
   - CLASS-07: Click edit icon -> expand -> add/remove students
   - CLASS-08: Click delete -> confirm -> class removed -> undo works
</verification>

<success_criteria>
1. Teacher can view list of all saved classes with student counts (CLASS-05)
2. Teacher can rename any saved class via inline edit (CLASS-06)
3. Teacher can edit students within a saved class via expand-in-place (CLASS-07)
4. Teacher can delete a saved class with confirmation and undo (CLASS-08)
5. Active class indicator updates when renaming or deleting the currently-loaded class
6. All existing class bank functionality (save/load) continues to work
</success_criteria>

<output>
After completion, create `.planning/phases/11-class-management-ui/11-02-SUMMARY.md`
</output>
