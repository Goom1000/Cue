---
phase: 50-quality-assurance
plan: 02
type: execute
wave: 2
depends_on: [50-01]
files_modified:
  - services/contentPreservation/qualityTestFixtures/RESULTS-sparse-fresh.md
  - services/contentPreservation/qualityTestFixtures/RESULTS-dense-fresh.md
  - services/contentPreservation/qualityTestFixtures/RESULTS-edge-fresh.md
  - services/prompts/contentPreservationRules.ts
autonomous: false

must_haves:
  truths:
    - "Preserved content appears in generated slides with core intent intact"
    - "Non-preserved content maintains elementary vocabulary level"
    - "Slide flow feels natural around preserved elements"
    - "Teleprompter introduces preserved questions conversationally"
  artifacts:
    - path: "services/contentPreservation/qualityTestFixtures/RESULTS-sparse-fresh.md"
      provides: "Completed quality review for sparse fixture"
      contains: "Overall Assessment"
    - path: "services/contentPreservation/qualityTestFixtures/RESULTS-dense-fresh.md"
      provides: "Completed quality review for dense fixture"
      contains: "Overall Assessment"
  key_links:
    - from: "services/prompts/contentPreservationRules.ts"
      to: "services/providers/claudeProvider.ts"
      via: "getPreservationRules import and injection"
      pattern: "getPreservationRules"
---

<objective>
Execute quality validation of content preservation across test fixtures and refine prompts if needed.

Purpose: Validate that preservation works correctly (QUAL-01 through QUAL-04) and iterate on prompts until quality matches pre-preservation baseline.
Output: Completed quality review documents and any necessary prompt refinements.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/50-quality-assurance/50-CONTEXT.md
@.planning/phases/50-quality-assurance/50-RESEARCH.md
@services/contentPreservation/qualityTestFixtures/REVIEW-CHECKLIST.md
@services/contentPreservation/qualityTestFixtures/elementary-math-sparse.md
@services/contentPreservation/qualityTestFixtures/elementary-science-dense.md
@services/prompts/contentPreservationRules.ts
@services/providers/claudeProvider.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate slides for all test fixtures and document outputs</name>
  <files>
    services/contentPreservation/qualityTestFixtures/RESULTS-sparse-fresh.md
    services/contentPreservation/qualityTestFixtures/RESULTS-dense-fresh.md
    services/contentPreservation/qualityTestFixtures/RESULTS-edge-fresh.md
  </files>
  <action>
For each test fixture, generate slides using the application and document the results:

1. **Start the dev server** if not running: `npm run dev`

2. **For each fixture (sparse, dense, edge-case):**
   a. Copy the fixture content
   b. Open the app at localhost:3000
   c. Create a new lesson with the fixture as lesson plan text
   d. Set grade level to Year 3 (sparse) or Year 4 (dense/edge) per fixture metadata
   e. Generate slides using Fresh mode (most common use case)
   f. Capture the generated output:
      - All slide titles and bullet content
      - Teleprompter script for 1-2 slides with preserved content
      - Note which preserved elements appear and where

3. **Create RESULTS-*.md files** using the REVIEW-CHECKLIST.md template:
   - Fill in the Preservation Verification table
   - Record observations for each quality dimension
   - Mark checklist items as checked if passing
   - Note any issues in the Issues Found table
   - Leave "Overall Assessment" blank for human review

Focus on Claude provider for this task (primary provider). Log exact preserved content locations for human verification.

IMPORTANT: If the dev server requires API keys that are not configured, log this as a blocker and proceed to document what WOULD be tested. The human checkpoint will address API access.
  </action>
  <verify>
Three RESULTS files exist with completed Preservation Verification tables:
```bash
ls services/contentPreservation/qualityTestFixtures/RESULTS-*.md
grep -l "Preservation Verification" services/contentPreservation/qualityTestFixtures/RESULTS-*.md
```
  </verify>
  <done>
RESULTS-sparse-fresh.md, RESULTS-dense-fresh.md, and RESULTS-edge-fresh.md created with:
- Preservation verification tables filled in
- Quality observations recorded for each dimension
- Issues (if any) documented
- Ready for human review
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human quality review and refinement decision</name>
  <what-built>
Generated slides for 3 test fixtures (sparse, dense, edge-case) with quality observations documented in RESULTS-*.md files.
  </what-built>
  <how-to-verify>
1. Open each RESULTS-*.md file in the qualityTestFixtures directory
2. For each result file, verify against the REVIEW-CHECKLIST criteria:

   **QUAL-01 (Vocabulary):**
   - Is non-preserved content using elementary vocabulary?
   - Any complex words that Year 3-4 students wouldn't understand?

   **QUAL-02 (Slide Flow):**
   - Do preserved elements feel integrated or jarring?
   - Are transitions natural between slides?

   **QUAL-03 (Teleprompter):**
   - Are preserved questions introduced conversationally?
   - Does the script read naturally, not robotically?

   **QUAL-04 (Layouts):**
   - Quick visual check: does content render correctly?

3. Mark "Overall Assessment" in each file as PASS or NEEDS REFINEMENT
4. If NEEDS REFINEMENT, describe specific prompt changes needed in the "Prompt Refinement Notes" section

**If any fixture fails quality review:**
Reply with the specific issues and recommended prompt changes to contentPreservationRules.ts

**If all fixtures pass:**
Reply with "approved" to proceed to completion
  </how-to-verify>
  <resume-signal>
Type "approved" if quality passes, or describe issues requiring prompt refinement
  </resume-signal>
</task>

<task type="auto">
  <name>Task 3: Apply prompt refinements if needed</name>
  <files>
    services/prompts/contentPreservationRules.ts
  </files>
  <action>
**If human review identified issues requiring refinement:**

1. Read the current contentPreservationRules.ts
2. Apply targeted changes based on the review feedback:
   - For vocabulary issues: Add explicit grade-level vocabulary guidance
   - For flow issues: Add integration context instructions
   - For teleprompter issues: Add conversational introduction examples
   - For layout issues: Add content length constraints

3. Follow the refinement pattern from 50-RESEARCH.md:
   - Replace/consolidate rather than accumulate (avoid prompt bloat)
   - Add specific examples of good vs bad behavior
   - Keep total prompt length reasonable

4. Re-run verification on the failing fixture(s) to confirm improvement

**If human review approved all fixtures:**

Skip this task (no refinement needed). Document in summary that all quality requirements passed without prompt changes.

IMPORTANT: Only modify prompts for issues flagged in human review. Do not preemptively add guidance for hypothetical issues.
  </action>
  <verify>
If changes made:
```bash
# TypeScript compiles
npx tsc --noEmit

# Verify changes are in the file
git diff services/prompts/contentPreservationRules.ts
```

If no changes needed:
```bash
echo "No refinement required - all quality checks passed"
```
  </verify>
  <done>
Either:
- Prompt refinements applied and verified to fix quality issues, OR
- No refinements needed (all fixtures passed quality review)
  </done>
</task>

</tasks>

<verification>
Phase 50 quality assurance complete:
1. Test fixtures exercised through the system
2. Quality review completed against QUAL-01 through QUAL-04 criteria
3. Prompt refinements applied if any issues found
4. Results documented for future reference
</verification>

<success_criteria>
1. All 3 test fixtures processed through slide generation
2. Preservation verification confirms preserved content appears in output
3. Human review confirms quality meets pre-preservation baseline
4. Any identified issues addressed via prompt refinement
5. TypeScript compiles after any changes
</success_criteria>

<output>
After completion, create `.planning/phases/50-quality-assurance/50-02-SUMMARY.md`
</output>
