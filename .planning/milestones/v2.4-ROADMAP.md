# Milestone v2.4: Targeted Questioning

**Status:** SHIPPED 2026-01-22
**Phases:** 15-18
**Total Plans:** 9

## Overview

Enable teachers to call on specific students by ability level. Grade assignments stored in class bank, AI generates question + answer for teleprompter, targeted mode selects students at the requested grade level with randomized cycling, and selected student name appears on the student view.

## Phases

### Phase 15: Student Grades

**Goal**: Teachers can assign and manage grade levels for each student in the class bank
**Depends on**: None (foundation phase)
**Plans**: 3 plans

Plans:
- [x] 15-01: Type and hook extension for grade data
- [x] 15-02: UI integration and export/import preservation
- [x] 15-03: Wire grade data through export/import flows (gap closure)

**Requirements:**
- GRAD-01: Teacher can assign grade level (A/B/C/D/E) to each student in class bank
- GRAD-02: Grade assignments persist in localStorage with class data
- GRAD-03: Modal UI to view and edit student grade assignments

**Success Criteria:**
1. Teacher can assign a grade level (A/B/C/D/E) to any student in the class bank
2. Grade assignments persist across browser sessions (localStorage)
3. Teacher can view all students with their assigned grades in a modal
4. Teacher can edit a student's grade level and see the change immediately
5. Saved classes include grade data when exported/imported

**Key Decisions:**
- Keep students[] array alongside studentData for backward compatibility
- studentData is optional so existing saved classes load without errors
- Migration happens on read from localStorage, not on write

---

### Phase 16: Question Enhancement

**Goal**: AI-generated questions include expected answers visible only to teachers
**Depends on**: None (independent of Phase 15)
**Plans**: 2 plans

Plans:
- [x] 16-01: AI service layer: generateQuestionWithAnswer with structured output
- [x] 16-02: UI: 5 difficulty buttons and answer display in teleprompter

**Requirements:**
- QGEN-01: AI generates question + expected answer for teleprompter
- QGEN-02: Five difficulty levels (A/B/C/D/E) available as buttons
- QGEN-03: Question difficulty matches selected grade level

**Success Criteria:**
1. When teacher clicks a difficulty button, AI generates both question and expected answer
2. Answer appears in teleprompter (teacher view only, not on student screen)
3. Five difficulty buttons (A/B/C/D/E) visible in teleprompter during presentation
4. Generated question difficulty matches the button clicked (A=hardest, E=easiest)

**Key Decisions:**
- Use difficulty levels A-E mapped to Bloom's taxonomy cognitive levels
- Answer format uses **bold** markers for key points teachers should listen for
- Color gradient from warm (rose=hardest) to cool (emerald=easiest)

---

### Phase 17: Targeting Mode

**Goal**: Teachers can switch between manual questioning and targeted student selection with fair cycling
**Depends on**: Phase 15 (needs grade assignments)
**Plans**: 3 plans

Plans:
- [x] 17-01: Cycling state infrastructure (shuffle, types, helpers)
- [x] 17-02: Mode toggle UI and conditional button rendering
- [x] 17-03: Progress counter, expandable list, and integration polish

**Requirements:**
- TARG-01: Toggle switch in teleprompter: Manual vs Targeted mode
- TARG-02: Manual mode: click grade -> generate question (current behavior)
- TARG-03: Targeted mode: click grade -> generate question + select student at that level
- CYCL-01: Students at each grade level cycled in randomized order
- CYCL-02: Track which students have been asked per grade level
- CYCL-03: Auto-reshuffle and restart cycle when all students at level asked
- CYCL-04: Reset tracking when navigating to a new slide

**Success Criteria:**
1. Toggle switch in teleprompter allows switching between Manual and Targeted modes
2. In Manual mode, clicking a grade button generates a question without selecting a student
3. In Targeted mode, clicking a grade button generates a question AND selects a student at that grade level
4. Students at each grade level are called in randomized order (not alphabetical, not predictable)
5. Each student at a grade level is asked once before any student is repeated
6. When all students at a level have been asked, the cycle reshuffles and restarts
7. Navigating to a new slide resets the tracking (students can be asked again)

**Key Decisions:**
- Fisher-Yates shuffle for unbiased randomization
- Targeted mode is default
- Cycling resets on slide change (per CYCL-04)
- Progress counter with expandable student list for teacher visibility

---

### Phase 18: Student Display

**Goal**: Selected student's name appears on the student view so the whole class sees who was called
**Depends on**: Phase 17 (needs student selection)
**Plans**: 1 plan

Plans:
- [x] 18-01: Banner overlay with BroadcastChannel sync and animations

**Requirements:**
- DISP-01: Student name appears as overlay banner on student view
- DISP-02: Banner shows "Question for [Name]" format
- DISP-03: Banner synced to student view via BroadcastChannel

**Success Criteria:**
1. When a student is selected in Targeted mode, their name appears on the student view
2. Banner displays "Question for [Name]" format (visible to whole class on projector)
3. Banner appears as overlay that doesn't disrupt slide content
4. Banner syncs instantly via BroadcastChannel (no delay)
5. Banner clears when question is dismissed or slide changes

**Key Decisions:**
- Banner uses indigo-600 to match PiPi brand colors
- Immediate clear on slide change (no exit animation) for instant sync
- Auto-dismiss with fade-out after 3 seconds
- Responsive font sizing for names 10-30+ characters

---

## Milestone Summary

**Key Decisions:**

- Data migration pattern: extend interface with optional field, migrate on read
- Five difficulty levels A-E mapped to Bloom's taxonomy cognitive levels
- Fisher-Yates shuffle for fair, unbiased student cycling
- BroadcastChannel message pattern: action + clear for ephemeral UI state

**Issues Resolved:**

- Export/import grade preservation (gap closure in 15-03)
- Backward compatibility for classes without grade data

**Issues Deferred:**

None - all v2.4 requirements satisfied.

**Technical Debt Incurred:**

None - all implementations production-ready per audit.

---

*For current project status, see .planning/ROADMAP.md (next milestone)*
*Archived: 2026-01-22 as part of v2.4 milestone completion*
