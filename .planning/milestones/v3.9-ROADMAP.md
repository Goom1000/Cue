# Milestone v3.9: Delay Answer Reveal

**Status:** SHIPPED 2026-02-01
**Phases:** 51-54
**Total Plans:** 8

## Overview

This milestone transforms Cue's AI slide generation to create deliberate "thinking pauses" for students. When the AI detects teachable moments (problems with answers), it splits them across progressive bullets and generates scaffolding strategies in the teleprompter to help teachers guide students through productive struggle before revealing answers.

## Phases

### Phase 51: Detection Foundation

**Goal**: Reliably identify problem-answer pairs in lesson content with conservative detection to preserve lesson flow

**Depends on**: Nothing (first phase of v3.9)

**Requirements**: DET-01, DET-02, DET-03, DET-04

**Success Criteria** (what must be TRUE):
1. AI receives XML-tagged teachable moments in system prompt for lesson content containing Q&A pairs, definitions, or math with results
2. Detection flags less than 30% of bullets to avoid fragmenting the lesson
3. Each detected moment includes content type classification (math, vocabulary, comprehension, science)
4. Problem-answer pairs are correctly associated (answer follows its problem)

**Plans:** 2 plans

Plans:
- [x] 51-01-PLAN.md - Answer detection and content classification (TDD)
- [x] 51-02-PLAN.md - Main detectTeachableMoments with throttling (TDD)

---

### Phase 52: Prompt Engineering Core

**Goal**: AI generates slides with problem/answer split across progressive bullets and scaffolding guidance in teleprompter

**Depends on**: Phase 51 (detection provides input for AI prompts)

**Requirements**: RST-01, RST-02, RST-03, RST-04, SCF-01, SCF-02, SCF-03

**Success Criteria** (what must be TRUE):
1. Problem bullet appears first with no answer leakage (answer text not visible until next reveal)
2. Answer appears as the immediately following progressive bullet on the same slide
3. Teleprompter shows strategy steps between problem and answer reveals
4. Each scaffolded moment includes 2-3 question prompts for teacher to guide student thinking
5. Transitions between problem, scaffolding, and answer feel natural (not jarring)

**Plans:** 2 plans

Plans:
- [x] 52-01-PLAN.md - Teachable moment prompt rules with scaffolding templates
- [x] 52-02-PLAN.md - Provider integration (Gemini + Claude)

---

### Phase 53: Scaffolding Templates

**Goal**: Scaffolding strategies match content complexity with subject-specific approaches

**Depends on**: Phase 52 (core scaffolding working, now specialized)

**Requirements**: SCF-04, SCF-05

**Success Criteria** (what must be TRUE):
1. Math problems get decomposition scaffolding (break into steps, estimate first, check units)
2. Vocabulary gets context scaffolding (word parts, sentence context, related words)
3. Comprehension gets evidence scaffolding (find in text, connect ideas, infer meaning)
4. Each scaffold prompt is verbally deliverable in under 20 words

**Plans:** 1 plan

Plans:
- [x] 53-01-PLAN.md - Add word count constraints to scaffolding templates

---

### Phase 54: Quality Assurance

**Goal**: Validated generation across diverse lesson content with no answer leakage or detection failures

**Depends on**: Phase 53 (all features implemented, now testing)

**Requirements**: QUA-01, QUA-02, QUA-03

**Success Criteria** (what must be TRUE):
1. Generated slides never leak answers in problem statements or scaffolding prompts
2. Detection and generation work correctly with math, reading, and science lesson plans of varying formats
3. Both Gemini and Claude providers produce equivalent scaffolded output

**Plans:** 3 plans

Plans:
- [x] 54-01-PLAN.md - Answer leakage prevention tests (QUA-01)
- [x] 54-02-PLAN.md - Format diversity detection tests (QUA-02)
- [x] 54-03-PLAN.md - Provider parity validation tests (QUA-03)

---

## Milestone Summary

**Decimal Phases:**

None - v3.9 executed cleanly without insertions.

**Key Decisions:**

- Answer detection uses pattern array with extractors for flexibility
- Content classification priority: math > vocabulary > science > comprehension > general
- PROXIMITY_THRESHOLD = 200 characters for answer pairing
- 30% max throttle rate to preserve lesson flow
- Vocabulary definitions must NOT repeat the vocabulary word (locked decision)
- Scaffolding uses 2-3 brief question prompts with [PAUSE] timing cues
- Canary string methodology for leakage detection testing
- Source code analysis validates provider parity (no live API tests)

**Issues Resolved:**

- None - milestone executed without blockers

**Issues Deferred:**

- PED-01, PED-02: Pedagogical phase awareness (heavier scaffolding in "I Do", lighter in "You Do")
- HNT-01, HNT-02: Hint progression (gentle → medium → strong)

**Technical Debt Incurred:**

None - all implementations are substantive with no TODOs or placeholder code.

---

_For current project status, see .planning/ROADMAP.md_

---
*Archived: 2026-02-01 as part of v3.9 milestone completion*
