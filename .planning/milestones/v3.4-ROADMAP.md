# Milestone v3.4: Ask AI

**Status:** SHIPPED 2026-01-26
**Phases:** 36-37
**Total Plans:** 5

## Overview

Teachers can ask AI anything during a presentation without leaving the app. In-presentation AI assistant with streaming responses, lesson context awareness, quick action buttons, and session history.

## Phases

### Phase 36: Core Ask AI

**Goal**: Teacher can ask AI questions during presentation and get contextual, streaming responses
**Depends on**: v3.3 completion
**Plans**: 4 plans

Plans:
- [x] 36-01: Provider interface and context types
- [x] 36-02: Gemini streaming implementation
- [x] 36-03: Claude SSE streaming implementation
- [x] 36-04: Ask AI panel UI and integration

**Details:**

Requirements Covered:
- CHAT-01: Text input field in teleprompter panel
- CHAT-02: Streaming response display
- CHAT-03: Loading indicator
- CHAT-04: Copy to clipboard
- CHAT-05: Error handling with retry
- CTXT-01: Lesson context injection
- CTXT-02: Age-appropriate responses
- CTXT-03: Quick action buttons
- UX-01: Inline panel (not modal)
- UX-02: Teacher-only visibility
- UX-03: Privacy indicator

Technical Notes:
- Extended AIProviderInterface with streamChat method using AsyncGenerator<string>
- Implemented in both Claude (SSE parsing) and Gemini (generateContentStream) providers
- buildChatContext helper constructs context from slides with gradeLevel
- Header dropdown UI (user-approved deviation from inline teleprompter)
- Character-by-character animation at 200 chars/sec using requestAnimationFrame

---

### Phase 37: History & Keyboard

**Goal**: Session history for reference and keyboard shortcuts for quick access
**Depends on**: Phase 36
**Plans**: 1 plan

Plans:
- [x] 37-01: History state, keyboard shortcuts, and history UI

**Details:**

Requirements Covered:
- HIST-01: Session history persistence
- HIST-02: Scrollable history view
- HIST-03: Clear history button
- KEY-01: Cmd/Ctrl+K shortcut
- KEY-02: Escape returns focus
- KEY-03: Arrow keys navigate slides

Technical Notes:
- askAIHistory state array accumulates Q&A during session
- History displays newest first via reverse() on render
- Cmd/Ctrl+K opens panel and focuses input
- Escape key blurs input to allow arrow key navigation
- Arrow keys in input automatically blur to preserve slide navigation

---

## Milestone Summary

**Key Decisions:**
- Header dropdown for Ask AI (user testing showed inline too cluttered)
- AsyncGenerator<string> pattern for streaming (not callbacks)
- ChatContext includes gradeLevel for age-appropriate responses
- Manual SSE parsing for Claude (EventSource doesn't support POST)
- Character animation at 200 chars/sec (5ms per char) using requestAnimationFrame
- Arrow keys blur input to preserve slide navigation
- History saved only after successful streaming completes
- Timestamp used as React key (guaranteed unique)

**Issues Resolved:**
- Initial inline teleprompter placement was too cluttered (moved to header dropdown)
- Button visibility in dark header (changed to white/inverse styling)
- Dropdown z-index conflicts (set to 40 for proper overlay)

**Issues Deferred:**
None

**Technical Debt Incurred:**
None - clean implementation with no TODOs or FIXMEs

---

_For current project status, see .planning/PROJECT.md_
_Archived: 2026-01-26 as part of v3.4 milestone completion_
